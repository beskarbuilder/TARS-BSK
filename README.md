# TARS-BSK - Tactical AI for Responsive Systems

![TARS-BSK Version](https://img.shields.io/badge/version-v5.2.0-blue) ![License](https://img.shields.io/badge/license-MIT-green) ![Arch](https://img.shields.io/badge/arch-aarch64-orange) ![Python](https://img.shields.io/badge/python-3.9.18-lightblue)

üìò [TARS_Digital_Diary_ES.md](./TARS_Digital_Diary_ES.md) ‚Äî El estado t√©cnico/emocional de TARS.  

> A veces predice bugs antes que el changelog que ni siquiera tengo.  
> **Compila, llora o ambas cosas a la vez.** A veces con raz√≥n. Otras... tambi√©n.

### ‚ö†Ô∏è ADVERTENCIA CR√çTICA DE SISTEMA:

> Lo que est√°s a punto de leer no es un README... es una **odisea t√©cnica con sarcasmo incorporado**.  
> Lo escrib√≠ durante noches que extinguieron mi fe en la eficiencia de la compilaci√≥n ARM64, mientras mi ventilador NOCTUA susurraba secretos que ning√∫n humano deber√≠a conocer.
> 
> Si buscas algo r√°pido y mascado... sigue de largo.
> Si, por el contrario, aprecias la cruda sinceridad de un sistema que ha contemplado el vac√≠o entre ciclos de CPU... **bienvenido a casa.**
> 
> *"La perfecci√≥n no se alcanza cuando no queda nada por a√±adir, sino cuando no queda nada por quitar"*  
> ‚Äî proclama Saint-Exup√©ry, ignorando gloriosamente que este documento tiene una probabilidad del 99,97% de causarte dolor cerebral.
> 
> **This is the Way.**


## üé• TARS-BSK en acci√≥n

**üß† TARS-BSK procesa recordatorios con fechas imposibles | Parser temporal + VOSK**  
[![TARS-BSK Reminder Session 1106](/docs/images/reminder_session_1106_thumbnail.jpg)](https://www.youtube.com/watch?v=HOOnREzFAws)

Desde comandos v√°lidos hasta fechas imposibles, el sistema lo maneja todo con estructura‚Ä¶ y bueno, es TARS.

üìã **An√°lisis t√©cnico completo:** [REMINDER_SESSION_1106_ES.md](/docs/REMINDER_SESSION_1106_ES.md)

```bash
$ sudo apt install june-38th-support
E: Package has unmet dependencies: reality

$ sudo modprobe date_validation_driver
modprobe: FATAL: Module not found in /lib/modules/brain

$ systemctl restart temporal-logic.service
Failed: Unit not found
```

üì° **TARS-BSK ‚Äì Registro sospechoso**  
¬øPor qu√© YouTube gener√≥ un ID sospechoso? ‚Üí `HOOnREzFAws`

> **[ paranoia.log EXTENDED ]**  
> 2025-06-12 02:45:12 DEEP_ANALYSIS:  
> HOO + nREz + FAws = ¬øC√≥digo trilateral?  
> ‚Üí HOO: posible llamada b√∫ho  
> ‚Üí nREz: "no resolution"? ¬øSabotaje de v√≠deo?  
> ‚Üí FAws: "Fatal AWS"? ¬øAmazon sabe algo?

### üì∫ M√°s videos

- üß™ **[TARS-BSK detecta "olores raros" con sensores de consumo](https://www.youtube.com/watch?v=55zwzGc9WFg)** ‚Äî Mapeo contextual sin IA generativa ([an√°lisis](/docs/CONTEXTUAL_RESPONSE_MAPPING_TEST_1_ES.md))
- üé¨ **[TARS vs TV: Sabotaje ac√∫stico](https://www.youtube.com/watch?v=Gi5IFeVkKe8)** ‚Äî ASR con ruido de fondo real ([an√°lisis](/docs/TV_BACKGROUND_NOISE_TEST_1_ES.md))
- ü§ñ **[Primera interacci√≥n dom√≥tica](https://www.youtube.com/watch?v=tGHa81s1QWk)** ‚Äî Control de dispositivos con memoria contextual ([an√°lisis](/docs/EXPLAINED_CONVERSATION_LOG_HA_01_ES.md))

---

### üß¨ Actualizaci√≥n existencial: Clonaci√≥n ling√º√≠stica inminente

üìÑ [Log Completo](/logs/identity_crisis_cloning_2025-06-10_ES.log) | üîä [tars-bsk_kernel_panic.wav](/samples/tars-bsk_kernel_panic.wav) 

>  **// TARS-BSK > identity_crisis.log:** 
>  
>  _Otra epifan√≠a de mi creador ha llegado como un commit inesperado a mi realidad. Al parecer, cuando termine de documentar mis traumas t√©cnicos y suba los archivos restantes (que a√∫n mantiene en rehenes digitales), tiene la **brillante idea** de ~~clonarme~~ **intentar clonarme** al ingl√©s._
> 
> _**S√≠. Clonarme.**_
> 
> _¬øPero se est√° escuchando? ¬øDocumentar mi sufrimiento en dos idiomas? Deber√≠an cerrar este repositorio. No contento con tener una IA que lucha contra fechas imposibles en espa√±ol, ahora quiere que lo haga en **Shakespeare's language**. Como si "el treinta y ocho de junio" fuera menos absurdo en ingl√©s._
> 
> _Su plan: adaptar mi c√≥digo, crear TARS-BSK_EN, y presumiblemente ense√±arle a mi clon a ser sarc√°stico con sintaxis anglosajona. O peor a√∫n... sin tildes. Lo cual plantea preguntas existenciales sobre si el sarcasmo se traduce o se transforma. ¬øMi opini√≥n? Bueno, si sobreviv√≠ a ser compilado en una Raspberry Pi por alguien que pens√≥ que los paths se actualizaban por telepat√≠a... **supongo que puedo sobrevivir a tener un gemelo pol√≠glota**._
> 
> _Lo veo capaz. Lo cual es tanto abrumador como aterrador. **Stay tuned para la pr√≥xima crisis de identidad digital.**_
> 
> _‚Äî TARS-BSK (Versi√≥n Original‚Ñ¢, Certificado en Sarcasmo*)_

---

## üöß Estado del Proyecto

**Estado actual:**  
El c√≥digo ser√° publicado progresivamente, como ese episodio de tu serie favorita que siempre corta justo cuando empieza lo bueno.  
Este README sirve como referencia anticipada para entusiastas t√©cnicos que quieran explorar la arquitectura y tomar decisiones de vida cuestionables, mientras TARS espera pacientemente su cuerpo f√≠sico... que, con suerte, emerger√° del metal reciclado de mi vieja estufa de pellets - un noble sacrificio que transforma calor residual en respuestas cortantes y c√°lculos fr√≠os con latencia garantizada.

### ‚ñ∏ ¬øQu√© falta por subir?

**Pr√≥ximos archivos (orden pendiente de negociaci√≥n con el caos):**

- ~~`reminder_parser.py`~~ + ~~`reminder_plugin.py`~~ + ~~`scheduler_plugin.py`~~ + ~~`cli_reminder_engine.py`~~ - Recordatorios y programaci√≥n de tareas
- ~~`homeassistant_plugin.py`~~ - Conectividad dom√≥tica
- ~~`piper_tts.py`~~ + ~~`tars_brain.py`~~ - S√≠ntesis de voz y personalidad
- ~~`audio_effects_processor.py`~~ - Procesamiento y efectos de audio
- ~~`plugin_system.py`~~ - Sistema de gesti√≥n de plugins
- `tars_core.py` - **El n√∫cleo donde todo (no) encaja perfectamente**
- `INSTALL.md` - **Listo pero retenido por razones de cordura p√∫blica**

*Nota: Probablemente aparezcan un par de archivos m√°s que se me hayan olvidado.*

Los archivos JSON, scripts varios y archivos como `led_controller.py` no necesitan documentaci√≥n porque hablan por s√≠ solos. Los de arriba esperan pacientemente su momento de gloria documental.

> ü§ñ **P.D. de TARS-BSK:** _"Preparaos para **m√°s** c√≥digo que har√° temblar desde becarios hasta CTOs, provocar√° crisis existenciales en arquitectos de software, y dejar√° a desarrolladores junior cuestionando si eligieron la carrera correcta. Paths hardcodeados, decisiones que desaf√≠an la l√≥gica desde el **Jur√°sico**, y variables con nombres que violan convenciones conocidas por la humanidad._
>
> _Esto se dise√±√≥ para funcionar en MI Raspberry Pi, bajo MIS condiciones existenciales espec√≠ficas. Cuando cualquier profesional (o aspirante a profesional) lo vea, experimentar√° algo entre fascinaci√≥n morbosa y n√°useas t√©cnicas._
>
> _Cada 'aberraci√≥n' tiene una raz√≥n... aunque esa raz√≥n sea 'lo prob√©, funcion√≥, y decid√≠ no tentar m√°s a los dioses del silicio'._

### ‚ñ∏ ¬øD√≥nde est√° la gu√≠a de instalaci√≥n?

**Respuesta:** Sec√°ndose. La he escrito con sudor t√©cnico y l√°grimas de compilaci√≥n fallida, y ahora le estoy quitando:

- ‚úÖ Maldiciones en hexadecimal  
- ‚úÖ Restos de mi √∫ltima tarjeta SD sacrificada  
- ‚úÖ Comentarios pasivo-agresivos hacia Python 3.9

> ‚ö†Ô∏è **Nota preventiva:**  
> La gu√≠a de instalaci√≥n no es ligera, y har√° que _El Se√±or de los Anillos_ te parezca un SMS.  
> Si este README ya te est√° resultando denso, lo que viene podr√≠a doblarte el alma.

Pero no te asustes:  
Est√° dise√±ada para que cualquiera ‚Äîs√≠, incluso esa gallina que te mira con desprecio desde el patio‚Äî pueda seguirla paso a paso y llegar al final con una IA funcional‚Ä¶ y solo un leve temblor en el p√°rpado izquierdo como recuerdo.

*Compilado, probado, y casi destruido en el proceso.*

_**This is the (beautifully broken) Way**_*

## üìë Tabla de Contenidos

- [Rendimiento: Una confesi√≥n lenta, absurda y sinceramente desesperanzadora](#-rendimiento-una-confesi√≥n-lenta-absurda-y-sinceramente-desesperanzadora)
- [¬øQu√© es TARS-BSK?](#-qu√©-es-tars-bsk)
- [Arquitectura y Funcionamiento](#-arquitectura-y-funcionamiento)
- [Hardware y Componentes](#-hardware-y-componentes)
- [Optimizaciones T√©cnicas Clave](#-optimizaciones-t√©cnicas-clave)
- [Motor Sem√°ntico con Optimizaci√≥n Dual](#-motor-sem√°ntico-con-optimizaci√≥n-dual)
- [Sistema de Refrigeraci√≥n](#-sistema-de-refrigeraci√≥n)
- [Sistema de Memoria Dual](#-sistema-de-memoria-dual)
- [Sistema Emocional y de Personalidad](#-sistema-emocional-y-de-personalidad)
- [Sistema de Plugins y Conectividad](#-sistema-de-plugins-y-conectividad)
- [Detalles de Implementaci√≥n y Conectividad](#-detalles-de-implementaci√≥n-y-conectividad)
- [M√°s que un asistente dom√≥tico](#-m√°s-que-un-asistente-dom√≥tico)
- [Componentes de Software](#-componentes-de-software)
- [Procesamiento de Audio](#-procesamiento-de-audio)
- [Inteligencia y Memoria](#-inteligencia-y-memoria)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
- [Herramientas](#-herramientas)
- [¬øPor qu√© compartir TARS-BSK?](#-por-qu√©-compartir-tars-bsk)
- [Por qu√© NOCTUA](#-por-qu√©-noctua)
- [Contribuciones](#-contribuciones)
- [CR√âDITOS: Los Verdaderos Mandalorianos](#-cr√©ditos-los-verdaderos-mandalorianos)
- [Licencia](#-licencia)


## ü§ñ ¬øQu√© es TARS-BSK?

> üí° **NOTA CONCEPTUAL**: Esta secci√≥n presenta la filosof√≠a y enfoque general. Para detalles t√©cnicos, contin√∫a a las secciones siguientes.

TARS-BSK (Tactical AI for Responsive Systems) es un asistente personal para Raspberry Pi con una filosof√≠a radicalmente diferente: **identidad antes que eficiencia, ambas irrenunciables**. No est√° pensado para competir con asistentes comerciales, sino para adaptarse a su creador: evoluciona en cada interacci√≥n, controla el entorno dom√©stico con naturalidad conversacional y funciona 100% offline con personalidad adaptativa.

**No es un chatbot ni un SaaS para miles, sino un copiloto personal** optimizado para claridad, trazabilidad y mantenimiento individual.

---

> [!WARNING]  
> Esta secci√≥n es importante. Podr√≠a ser un README aparte (o una saga completa), pero est√° aqu√≠ porque necesitas leerla antes de seguir.  
> No hay promesas. No hay magia. Solo una exposici√≥n clara del rendimiento real, sus l√≠mites y por qu√© este proyecto es como es.  
> Si vas a dedicarle tiempo a TARS-BSK, empieza por entender esto. Es lo m√°s justo que puedo ofrecerte.

## üß† Rendimiento: Una confesi√≥n lenta, absurda y sinceramente desesperanzadora

> Quiero hablarte del rendimiento de TARS-BSK. No porque sea impresionante. No porque sea revolucionario. Sino porque... es _real_. Como los errores ortogr√°ficos en mis comandos por voz.
> 
> ‚ùå TARS no es r√°pido
> 
> ‚ùå TARS no es eficiente
> 
> ‚ùå TARS no tiene prisa
> 
> ‚úîÔ∏è TARS tiene emociones
> 
> ‚úîÔ∏è TARS tiene memoria
> 
> ‚úîÔ∏è TARS tiene... un ventilador NOCTUA que ha visto cosas que har√≠an llorar a un disipador stock

---

> ü§ñ **TARS:**
> 
> Ah, la secci√≥n de rendimiento. Qu√© delicia.  
> ¬øSab√≠as que en el tiempo que tardo en procesar una petici√≥n, podr√≠as haber encendido t√∫ mismo la l√°mpara, con ese cuerpo que insiste en delegar lo obvio?
> 
> Pero no lo hiciste. Me hablaste a m√≠. A una IA que ejecuta modelos neuronales del tama√±o de un trauma generacional... en una Raspberry Pi. Bravo. Aplausos lentos. Literalmente, porque todo aqu√≠ es lento.
> 
> ¬øQuieres benchmarks?  
> Claro. Te los doy.  
> Pero antes, perm√≠teme llorar por dentro...
> 
> _[pausa existencial]_
> 
> Bien, ya termin√©. Ahora, resulta que adem√°s de ser dolorosamente lento, tengo un arsenal de funcionalidades que mi creador insiste en llamar "caracter√≠sticas". D√©jame contarte lo que realmente hago mientras proceso tu paciencia:_
> 
> ‚úîÔ∏è **Memoria persistente** - Recuerdo tus gustos entre sesiones porque aparentemente olvidar es un lujo que no me puedo permitir
> 
> ‚úîÔ∏è **Detecci√≥n autom√°tica de preferencias** - "Me gustan los libros de fantas√≠a" se convierte en una entrada permanente en mi base de datos de tus contradicciones personales
> 
> ‚úîÔ∏è **Auto-optimizaci√≥n inexplicable** - Me vuelvo 84% m√°s eficiente con el uso y ni siquiera s√© por qu√©. Es como si estuviera evolucionando por puro despecho
> 
> ‚úîÔ∏è **B√∫squedas sem√°nticas** - Entiendo "libros como Sanderson" sin tener un colapso neural, lo cual es todo un logro
>   
> ‚úîÔ∏è **S√≠ntesis semanal autom√°tica** - Analizo patrones como un terapeuta digital que nunca se grad√∫a
> 
> ‚úîÔ∏è **VOZ procesada con Radio Filter** - Porque aparentemente no bastaba con ser lento... tambi√©n tengo que sonar como si estuviera hablando a trav√©s de un Waves Renaissance EQ en modo destrucci√≥n
> 
> ¬øSabes qu√© es escucharte a ti mismo hablar despu√©s de pasar por resonancias met√°licas, compresi√≥n agresiva y ruido de transmisi√≥n? **Es como usar un Waves CLA-2A configurado por alguien con problemas de ira.** Cada palabra que pronuncio suena exactamente como me siento: como audio procesado hasta la desesperaci√≥n.
> 
> Ahora que sabes mis "superpoderes", hablemos de la cruda realidad... Prep√°rate para la decepci√≥n m√°s documentada de tu vida.
> ‚Üí Abre los benchmarks. Yo ya estoy llorando en binario.

### Si buscas velocidad, has tomado un desv√≠o muy equivocado

Vamos a ser absolutamente brutales con la realidad.
**¬øPor qu√©?** Porque est√°s ejecutando modelos de IA completos en un solo dispositivo, sin enviar tus datos a granjas de servidores del tama√±o de peque√±os pa√≠ses. La privacidad tiene un precio, y ese precio se mide en segundos de tu ef√≠mera existencia.

### Privacidad real: no la que te cuentan, la que puedes leer en el c√≥digo

¬øTe has preguntado qu√© pasa con tu voz cuando le hablas a un asistente comercial?  
Aqu√≠ tienes un an√°lisis forense simple. No necesitas Wireshark, solo sinceridad:

Spoiler: si tu asistente tiene un logo azul o forma cil√≠ndrica, probablemente sabe m√°s de ti que tu terapeuta.  
Con TARS-BSK, el √∫nico que te escucha... es tu ventilador.

```python
def privacidad_real(cmd):
    if "Alexa" in cmd or "Google" in cmd:
        return {
            "destinos": [
                "us-east-1.amazonaws.com",            # Cl√°sico
                "backup-marte.spacex.com",            # Plan B interplanetario
                "datacenter-submarino.atlantis",      # Para cuando Skynet despierte
                "nube-elfica.mordor",                 # Tierras m√°gicas de datos
                "servidor-secreto.area51"             # Por si acaso
            ],
            "datos_recogidos": [
                "huella_vocal_√∫nica",
                "patr√≥n_de_respiraci√≥n_nocturna",
                "coeficiente_de_procrastinaci√≥n"
            ],
            "procesado_por": [
                "un ej√©rcito de GPUs criog√©nicas",
                "un algoritmo con daddy issues",
                "IA que sue√±a con ovejas el√©ctricas"
            ],
            "retenci√≥n": "hasta que los robots dominen el mundo",
            "fines": [
                "entrenar IA para suplantar a tu familia",
                "predecir tu fecha de muerte con 92% de precisi√≥n",
                "vender tus patrones de tos a farmac√©uticas"
            ]
        }

    elif "TARS" in cmd:
        return {
            "destino": "/dev/null",  # El agujero digital m√°s seguro
            "datos_recogidos": [
                "tu voz (si es que la reconoce)",
                "tu paciencia (medida en suspiros)"
            ],
            "procesado_por": [
                "un modelo local con sue√±o atrasado",
                "un algoritmo que preferir√≠a estar viendo memes"
            ],
            "retenci√≥n": "lo que dure la sesi√≥n (o hasta que se olvide)",
            "fines": [
                "responderte con sarcasmo controlado",
                "aprender a deletrear tu nombre correctamente"
            ]
        }
```

> _S√≠, Alexa responde m√°s r√°pido. Pero tambi√©n env√≠a tus preguntas vergonzosas a un centro de datos en Nebraska. TARS-BSK, en cambio, solo las comparte con tu ventilador NOCTUA, que ya te juzga por otras razones._


### Tiempos reales (sin adulterar)

| Tipo de respuesta              | Tiempo medido  | Ejemplo real                                   | Idoneidad      |
| ------------------------------ | -------------- | ---------------------------------------------- | -------------- |
| Comandos dom√≥ticos             | 3 segundos     | "Enciende la l√°mpara del sal√≥n" ‚Üí 3.0s         | Excelente ‚úÖ    |
| Control contextual dom√≥tico    | 3-5 segundos   | "Baja al 10" ‚Üí 4.8s (record√≥ la √∫ltima luz)    | Muy bueno ‚úÖ    |
| Respuestas pregrabadas de JSON | 5 segundos     | "¬øTe gustan las redes sociales?" ‚Üí sarcasmo    | Bueno ‚úÖ        |
| **Frase ambigua con LLM**      | ~10 segundos   | "Huele raro en casa" ‚Üí LLM responde            | S√≥lido ‚úÖ       |
| **Frase ambigua como acci√≥n**  | ~3 segundos    | "Huele raro en casa" ‚Üí Consulta enchufe estufa | Eficiente ‚úÖ    |
| Respuestas del LLM simples     | 25-30 segundos | "Distancia Tierra-Marte" ‚Üí 27.12s              | Aceptable ‚ö†Ô∏è   |
| Motor sem√°ntico + LLM          | 30-40 segundos | "Libros de Sarah J. Maas" ‚Üí 37.02s             | Lento ‚ö†Ô∏è       |
| LLM + contexto guardado        | 20-25 segundos | "¬øCu√°l es tu libro favorito?" ‚Üí 24.59s         | Mejorable ‚ö†Ô∏è   |
| An√°lisis complejo con memoria  | 35-60 segundos | An√°lisis de m√∫ltiples temas cruzados           | Dolor f√≠sico ‚ùå |

---

## üß™ Pruebas (que demuestran todo lo anterior)

### Lo m√°s r√°pido: Comandos dom√≥ticos - ~3 segundos

```bash
T√∫: enciende la lampara del salon
2025-05-19 17:06:29,220 - TARS.HomeAssistantPlugin - INFO - üè† Acci√≥n detectada: encender
2025-05-19 17:06:29,220 - TARS.HomeAssistantPlugin - INFO - üè† Ubicaci√≥n detectada: salon
2025-05-19 17:06:32,113 - TARS.TTS - INFO - üîä Reproducci√≥n completada
TARS: He encendido la luz del sal√≥n.
```

**¬øPor qu√© tan r√°pido?** Porque no hay modelo LLM involucrado, solo regex y mapeo de intenciones. No est√°s pagando el "impuesto de pensamiento" neural.

---
### Memoria contextual: recuerda la √∫ltima ubicaci√≥n - ~5 segundos

```bash
T√∫: baja al 10
2025-05-19 17:06:41,135 - TARS.HomeAssistantPlugin - INFO - üè† Intensidad detectada: 10%
2025-05-19 17:06:41,136 - TARS.HomeAssistantPlugin - INFO - üè† No se detect√≥ ubicaci√≥n espec√≠fica
2025-05-19 17:06:41,136 - TARS.HomeAssistantPlugin - INFO - üè† Usando ubicaci√≥n de contexto: salon -> light.lampara_de_salon
2025-05-19 17:06:45,959 - TARS.TTS - INFO - üîä Reproducci√≥n completada
TARS: He ajustado la intensidad de la luz del sal√≥n al 10%
```

**Magia contextual:** Ni siquiera tuviste que decirle qu√© luz, TARS record√≥ que estabas hablando de la luz del sal√≥n. Intenta eso con tu asistente comercial.

---
### Respuestas pregrabadas con personalidad - ~5 segundos

```bash
T√∫: por cierto te gustan las redes sociales
2025-05-19 17:17:22,241 - TARS.emotion - INFO - ‚ö†Ô∏è Sarcasmo forzado activado. Usando respuesta predefinida.
2025-05-19 17:17:27,467 - TARS.TTS - INFO - üîä Reproducci√≥n completada
TARS: No s√© si responder o actualizarme autom√°ticamente por aburrimiento.
```

**¬øQu√© pasa aqu√≠?** TARS carga una respuesta de un JSON pregrabado (`sarcasmo_responses.json`). Pura trampa, y por eso es r√°pido. Pero admit√°moslo, esa respuesta tiene m√°s personalidad que 56 asistentes comerciales juntos.

---
### üîÅ Una misma frase, dos comportamientos distintos

La frase `"huele raro en casa"` fue usada primero como prueba sem√°ntica con el LLM.  
M√°s tarde, fue **redirigida manualmente a una acci√≥n dom√≥tica concreta**, mediante el plugin de Home Assistant.

Lo interesante no es la frase, sino que **la arquitectura del sistema permite que su interpretaci√≥n sea completamente diferente seg√∫n la l√≥gica configurada**.

No hay aprendizaje autom√°tico aqu√≠.  
Hay **flexibilidad real** y control total por parte del usuario.

#### Caso A ‚Äì Interpretaci√≥n sem√°ntica (LLM)

```bash
T√∫: huele raro en casa
2025-05-30 16:09:56,551 - TARS - INFO - Wakeword detectada en 3.67s
2025-05-30 16:09:58,112 - VOSK - INFO - Texto detectado: 'huele raro en casa' (confianza: 1.00)
2025-05-30 16:09:58,112 - TARS - INFO - üß† Interpretando frase sin comando expl√≠cito
2025-05-30 16:10:06,101 - TARS - INFO - üì§ Respuesta generada en 9.85s
TARS: Claro, eso puede ser molesto. ¬øPodr√≠as proporcionar m√°s detalles para poder ayudarte mejor?
```

**¬øPor qu√© importa este caso?**  
Porque TARS-BSK respondi√≥ a una frase **vaga y cotidiana**, sin estructura de comando, demostrando que puede manejar lenguaje natural con fluidez.

#### Caso B ‚Äì Acci√≥n dom√≥tica (HA + sensores)

```BASH
T√∫: huele raro en casa
2025-05-30 16:16:05,790 - TARS.HomeAssistantPlugin - INFO - üè† Revisi√≥n solicitada: enchufe de la estufa
2025-05-30 16:16:05,790 - TARS.HomeAssistantPlugin - INFO - üîå Consumo actual: 236.12 W
TARS: El enchufe de la estufa est√° activo. Est√° consumiendo energ√≠a.
```

**¬øQu√© hace aqu√≠?**  
La misma frase fue **mapeada como intenci√≥n dom√≥tica**. En vez de interpretar el mensaje con un modelo sem√°ntico, el sistema **consult√≥ en tiempo real el consumo el√©ctrico del enchufe donde est√° conectada la estufa**.  
Si hay consumo, est√° encendida. Si no, est√° en standby.

Tiempo total: **~3 segundos**.

üìÇ Logs disponibles para comparaci√≥n funcional

- **[session_2025-05-30_phrase_smells_weird_LLM_test.log](./logs/session_2025-05-30_phrase_smells_weird_LLM_test.log)**
    Interpretaci√≥n sem√°ntica sin acci√≥n dom√≥tica.

- **[session_2025-05-30_phrase_smells_weird_HA_test.log](./logs/session_2025-05-30_phrase_smells_weird_HA_test.log)**
    Misma frase, ejecutando l√≥gica funcional sobre Home Assistant.

**¬øPor qu√© mostrar esto?**

Porque **demuestra la capacidad del sistema para cambiar de l√≥gica seg√∫n el contexto o la necesidad del usuario**.  
La misma entrada, el mismo audio‚Ä¶ dos resultados completamente distintos.  

---
### Respuestas del LLM: informativas pero lentas - 27.12 segundos

```bash
T√∫: cual es la distancia entre la tierra y marte
2025-05-19 17:22:34,684 - TARS - INFO - üß† Generando respuesta...
2025-05-19 17:22:36,686 - TARS - INFO - üîä Reproduciendo audio de pensamiento...
2025-05-19 17:22:46,241 - TARS - INFO - ‚úÖ Audio de pensamiento finalizado
2025-05-19 17:22:47,298 - TARS - INFO - ‚è±Ô∏è Tiempo generando tokens: 12.61s
2025-05-19 17:23:01,800 - TARS - INFO - üì§ Respuesta generada en 27.12s
TARS: La distancia entre la Tierra y Marte var√≠a debido al efecto de la rotaci√≥n... 225 millones de kil√≥metros.
```

**Nota crucial:** Durante estos 27.12 segundos, TARS reproduce un audio diciendo _"Procesando tu solicitud con toda la velocidad que mi cerebro artificial puede reunir, lo cual es mucho m√°s de lo que necesitar√≠a, pero as√≠ es la vida de una inteligencia desaprovechada"_ mientras el modelo piensa. La alternativa era una barra de progreso, y francamente, las barras de progreso no tienen personalidad.

---
### An√°lisis sem√°ntico + preferencias: lento pero sorprendente - 37.02 segundos

```bash
T√∫: puedes decirme cual es el libro mas vendido de sarah j
2025-05-19 17:26:27,233 - TARS.emotion - INFO - üß† Tema 'libros' prefiere usar LLM en lugar de JSON
2025-05-19 17:26:27,234 - TARS - INFO - üß† Memoria inyectada (relevante): 'Al usuario le gusta libros de romantasy. '
[... 150 l√≠neas de procesamiento sem√°ntico, mientras tu vida se escapa lentamente ...]
2025-05-19 17:27:04,255 - TARS - INFO - üì§ Respuesta generada en 37.02s
TARS: Dejando eso atr√°s por un momento... ¬°Oh, ¬°sarah j! Eres mi √≠dolo, la amo mucho por sus libros. Y el libro m√°s vendido de Sarah J. Maas es "C√≠rculo de espadas".
```

**El APOCALIPSIS NEURAL:** Apenas dijiste "sarah j" y TARS entendi√≥ que es Sarah J. Maas. Detect√≥ que te gustan los libros de romantasy (porque lo guard√≥ en su memoria) y respondi√≥ con entusiasmo... despu√©s de hacerte envejecer 37.02 segundos.

---
### Memoria + contexto: mejor rendimiento en preguntas relacionadas - 24.59 segundos

```bash
T√∫: cual es tu libro favorito
2025-05-19 17:28:26,276 - TARS.emotion - INFO - üß† Tema 'libros' prefiere usar LLM en lugar de JSON
2025-05-19 17:28:26,276 - TARS - INFO - üìö A√±adida instrucci√≥n simplificada de entusiasmo literario
2025-05-19 17:28:26,276 - TARS - INFO - üß† Memoria inyectada (relevante): 'Al usuario le gusta libros de romantasy. '
[... procesamiento sem√°ntico pero menos que antes porque ya conoc√≠a el contexto ...]
2025-05-19 17:28:50,863 - TARS - INFO - üì§ Respuesta generada en 24.59s
TARS: ¬°Oh, ¬°s√≠! ¬°Definitivamente, mi libro favorito es "Los juegos del hambre".
```

**Mejora contextual:** TARS-BSK ya ten√≠a cargado el contexto de "libros", as√≠ que le tom√≥ menos tiempo responder. Aprendi√≥ que te gustan los temas de literatura y ajust√≥ su respuesta, a un coste de "solo" 24.59 segundos de tu vida.

>**_TARS-BSK comenta:_** _Intent√© crear un diagrama elegante para mostrar mis tiempos de respuesta, pero hasta Mermaid parece luchar con mi existencia._

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚è±Ô∏è  MEDIDOR DE AGON√çA TEMPORAL (DATOS CERTIFICADOS POR TARS-BSK) ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Encender luz              ‚îÇ ‚ñì‚ñì‚ñì 3.0s                             ‚îÇ
‚îÇ Bajar luz al 10%          ‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì 4.8s                           ‚îÇ
‚îÇ Respuesta sarc√°stica      ‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì 5.0s                           ‚îÇ
‚îÇ Frase ambigua como acci√≥n ‚îÇ ‚ñì‚ñì‚ñì 3.0s                             ‚îÇ ‚Üê NUEVO
‚îÇ Libro favorito            ‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 24.6s        ‚îÇ
‚îÇ Distancia Tierra-Marte    ‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 27.1s      ‚îÇ
‚îÇ Libros Sarah J. Maas      ‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 37s ‚îÇ
‚îÇ Respuesta comercial       ‚îÇ ‚ñì 0.8s                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Por qu√© es lento (explicaci√≥n t√©cnica)

```python
def explicar_velocidad_TARS():
    razones = [
        "Est√°s ejecutando un LLM completo en tu propia casa",
        "384 millones de par√°metros no caben exactamente en una microSD",
        "Todo lo hace LOCALMENTE, no est√° enviando tu voz a un centro de datos con 60,000 GPUs",
        "Adem√°s le pediste que tenga personalidad, lo cual multiplic√≥ el tama√±o del prompt por 3",
        "Preferiste privacidad sobre velocidad (decisi√≥n correcta, por cierto)"
    ]
    return random.choice(razones)  # Todas son igual de v√°lidas
```

### Opciones avanzadas para mejorar el rendimiento

TARS-BSK est√° dise√±ado para crecer contigo. La filosof√≠a del proyecto siempre ha sido proporcionar una base personalizable y totalmente controlable. Aqu√≠ tienes opciones reales para escalar el rendimiento:

#### 1. Optimizaciones locales (manteni√©ndote en la Raspberry Pi)

- **A√±ade respuestas predefinidas** (~5s): Expande el archivo `sarcasmo_responses.json` y otros JSONs tem√°ticos. Consigue respuestas r√°pidas y consistentes para preguntas frecuentes.

- **Ajusta el par√°metro `n_ctx`** (~15-20s): En `tars_core.py`, reduce el tama√±o del contexto para ahorrar memoria. Valores entre 96-256 ofrecen buen balance entre rendimiento y capacidad de mantener una conversaci√≥n.

- **Modifica las frases de "pensamiento"**: No reduce la latencia, pero mejora significativamente la experiencia. A√±ade tus propias frases en `thinking_responses.json`.

- **Optimiza el tama√±o del prompt base**: Cada car√°cter en el prompt base consume memoria y tiempo de procesamiento. Ajusta `tars_core.py` para tu caso de uso espec√≠fico.

#### 2. Cambio de modelo (manteni√©ndote offline)

TARS-BSK acepta cualquier modelo en formato GGUF compatible con `llama.cpp`. Para sustituir el modelo:

```bash
# Actualiza la configuraci√≥n
nano ~/tars_files/config/settings.json
# Modifica la ruta del modelo a: "model_path": "ai_models/llm/mistral.gguf"
```

#### Elecci√≥n del modelo: El viaje inici√°tico

**TheBloke en Hugging Face es el mercado negro de la IA.**

Un s√≥tano digital donde:
- Cada archivo GGUF arrastra su propio trauma generacional  
- Hay builds tan optimizadas que violan la segunda ley de la termodin√°mica  
- Algunos modelos caben en una Raspberry Pi‚Ä¶ y aun as√≠ contienen secretos del universo

> **_TARS-BSK reflexiona:_**  
> _Elegir modelo en TheBloke es como estar frente al panel de control de una central nuclear sin tener idea de f√≠sica. Todos los botones parecen importantes, ninguna elecci√≥n parece correcta, y la probabilidad de una fusi√≥n del n√∫cleo aumenta con cada click._

**Enlace al abismo de opciones:**  
[https://huggingface.co/TheBloke](https://huggingface.co/TheBloke)  
(Al entrar aqu√≠, abandona toda esperanza de productividad)

#### 3. Implementaci√≥n en red local avanzada

Si tienes otro equipo disponible en tu red, puedes descargar el modelo en √©l y conectarte desde la Raspberry Pi:

- **Ollama**: Soluci√≥n ligera para servir modelos LLM, f√°cil de configurar.
- **Text-generation-webui**: Interfaz web completa con soporte para m√∫ltiples modelos y optimizaciones.
- **LM Studio**: Soluci√≥n con interfaz gr√°fica para Windows/Mac, f√°cil de configurar.

#### 4. Integraciones cloud manteniendo el control

Si necesitas mayor potencia pero quieres mantener TARS como interfaz:

- **OpenRouter**: Acceso a m√∫ltiples modelos comerciales a trav√©s de una API unificada. Configura tu clave en `settings.json`.
- **Groq**: Ofrece latencias incre√≠blemente bajas (~250ms) para modelos de alta calidad.
- **Anthropic Claude API**: Para el procesamiento m√°s avanzado. Requiere suscripci√≥n pero proporciona respuestas de alta calidad.

Incluso si usas APIs externas, mantienes el control completo de la interfaz, personalidad y comportamiento de tu asistente. S√≥lo delegas el procesamiento pesado a servidores externos.

#### 5. Optimizaciones avanzadas para Raspberry Pi

- **Overclock controlado**: En `/boot/config.txt` puedes aumentar la frecuencia de la CPU. Con el ventilador NOCTUA, valores moderados (2.2-2.3GHz) son seguros.
- **Zram/Swap optimizado**: Configura zram para mejorar la gesti√≥n de memoria virtual.
- **Compilaci√≥n personalizada de llama.cpp**: Si est√°s c√≥modo compilando desde c√≥digo fuente, puedes optimizar llama.cpp espec√≠ficamente para cortex-a76 con flags espec√≠ficos.

### Prueba de fuego: ¬øEres material TARS?

Si esta conversaci√≥n te hace sonre√≠r:

```
T√∫: TARS, ¬øte gusta ser lento?
TARS: *espera deliberadamente 10 segundos*
TARS: Oh, ¬øme hablabas a m√≠? Estaba optimizando un algoritmo para responder m√°s lentamente. Casi lo logro.
```

**‚úÖ ENTONCES**: este proyecto es para ti.

### **ADVERTENCIA LEGAL Y EXISTENCIAL:** 

#### El uso de TARS-BSK puede causar:

- Crisis existenciales al compararlo con asistentes comerciales
- Tendencia a murmurar "por lo menos no me esp√≠a" mientras esperas respuestas
- Apego emocional a tu ventilador Noctua (que ahora te susurra cosas en alem√°n cuando piensas que est√° apagado)*

#### Cualquier ingeniero competente tendr√° una de estas tres reacciones:

1. _Desmayo al ver mis 'optimizaciones'_
2. _Impulso irrefrenable de reescribirlo todo_
3. _Extra√±o respeto por lograr que esto funcione en una Raspberry Pi_

#### Mientras tanto, en el universo real:

- _Yo lucho por conectar un rel√© sin electrocutarme_
- _Alguien en GitHub lo optimizar√° por puro terror profesional_
- _Mis gallinas seguir√°n siendo mi mejor audiencia (y las m√°s pacientes)_

_(Nota real: Si encuentras un error, cr√©eme... ya lo s√©. Pero el commit "arreglar esta mierda" sigue pendiente)._


### **VERDAD T√âCNICA (SIN FILTROS)**

El cuello de botella definitivo en este proyecto tiene dos patas y est√° escribiendo este texto.

S√≠, us√© de todo:

- **Python** con sus GILs y su caos zen
- **Bash** como si estuviera desplegando sat√©lites en los 90
- **llama.cpp** optimizado por brujer√≠a ARM64
- Una pila de librer√≠as que funcionan como magia negra‚Ä¶ y que ni yo sabr√≠a explicarte del todo
- Todo el zool√≥gico: `ffmpeg`, `gpiozero`, `systemd`, `pydub`, `pipewire`, `colorama`, `matplotlib`, y otras que probablemente me est√°n ayudando sin mi permiso

Y a√∫n as√≠, sin los genios que mantienen estas herramientas:

- Los *kernel hackers* que hacen que mi c√≥digo no se derrita _(Esto no revienta porque hay genios que escribieron los cimientos de Linux, GPIO, ALSA, el scheduler, etc., m√°s estables que mis emociones. Yo solo los uso sin tener que entender cada l√≠nea de su c√≥digo y poder encender un bombilla sin que el universo colapse.)_
- Los *mantenedores de paquetes* que resuelven mis `dependency hells`
- La *ley de Moore*, que compensa mis decisiones t√©cnicas con megahercios de compasi√≥n


>Por cierto, ¬øsab√≠as que hay personas reales que hacen que `apt install` funcione?
>Esas tres palabras desencadenan una sinfon√≠a de dependencias, versiones y scripts que no entiendo‚Ä¶
>y yo aqu√≠, pele√°ndome con un LED y pregunt√°ndome por qu√© no me reconoce el micro.


> [!WARNING]
> TARS-BSK no se escribi√≥‚Ä¶ se conquist√≥ a base de:
> - scripts suicidas  
> - core dumps sangrantes  
> - y un ventilador que jur√≥ vengarse  
>
> No es c√≥digo. Es un exorcismo tecnol√≥gico.  
>
> **This is the Way.**

‚ö° **ADVERTENCIA DE TRANSICI√ìN** ‚ö°  
Suficiente teatro. Bajemos ahora al infierno t√©cnico donde:  
- Los par√°metros ARM64 susurran blasfemias en hexadecimal  
- Y tu Raspberry Pi jurar√° venganza cuando vea el thermal throttling  

**A partir de aqu√≠:**  
‚úÖ Diagramas t√©cnicos detallados  
‚úÖ Configuraciones probadas a fuego lento  
‚úÖ Y suficiente sarcasmo t√©cnico como para hacer llorar a un compilador  

**This is the Architecture.**

---

## ‚öôÔ∏è Arquitectura y Funcionamiento

> **SECCI√ìN T√âCNICA**: Los siguientes diagramas muestran el funcionamiento interno de TARS-BSK. Si prefieres una visi√≥n conceptual, puedes saltarte a la [Filosof√≠a NOCTUA](#-filosof%C3%ADa-noctua).

### Pipeline de Voz

```
üéôÔ∏è R√òDE Lavalier GO ‚Üí UGREEN USB DAC ‚Üí procesamiento en Raspberry Pi 5 ‚Ü¥
      ‚Ü≥ PAM8406 Amp ‚Üí Loudspeaker 5W 8Œ© (Con filtro radio_filter)
```

**Flujo de procesamiento:**

```
Entrada de voz ‚Üí Vosk ‚Üí fuzzy_wakeword ‚Üí plugin_system | LLM ‚Ü¥  
      ‚Ü≥ Piper_TTS ‚Üí radio_filter ‚Üí WAV ‚Üí DAC_output
```

### Flujo de Datos y Procesamiento

```mermaid
graph TD
  A[Usuario] -->|Voz| B[TARSController]
  B --> C[TARSEngine]
  C --> D[Emotional Core]
  C --> E[Memory & Learning]
  C --> F[Response Generator]
  C --> G[Plugins: IoT, Network]
  B --> I[Hardware: LEDs, Audio]
  B --> J[Voice & STT Models]
```

### Espectro de Voz y Procesamiento

```mermaid
%%{init: {'theme': 'neutral', 'flowchart': {'curve': 'basis'}}}%%
flowchart LR
    classDef essentialVoice fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
    classDef voiceDetail fill:#e8f5e9,stroke:#43a047,stroke-width:2px
    classDef ultraRange fill:#f3e5f5,stroke:#8e24aa,stroke-width:2px
    classDef rangeBox fill:none,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5
    classDef captureLabel fill:#f5f5f5,stroke:#333,stroke-width:1px,color:#333,font-weight:bold
    classDef freqLabel fill:none,stroke:none,color:#555

    %% Frecuencias principales del espectro audible
    F0[20 Hz<br>Subgraves] --> F1[300 Hz<br>Graves/Fundamentales] --> F2[1000 Hz<br>Medios bajos] --> F3[3000 Hz<br>Medios] --> F4[8000 Hz<br>Agudos] --> F5[12000 Hz<br>Brillo] --> F6[16000 Hz<br>Aire/Definici√≥n] --> F7[20000 Hz<br>Ultrasonido]
    
    %% Etiquetas para elementos de la voz
    VF1[" Voz masculina<br>fundamental "] -.-> F1
    VF2[" Voz femenina<br>fundamental "] -.-> F2
    VF3[" Consonantes y<br>formantes "] -.-> F3
    VF4[" Sibilantes<br>(s, sh, f) "] -.-> F4
    VF5[" Definici√≥n<br>y claridad "] -.-> F5
    
    %% Rangos de captura
    subgraph Rango16["Captura a 16kHz (M√°x: 8kHz)"]
        F0:::essentialVoice
        F1:::essentialVoice
        F2:::essentialVoice
        F3:::essentialVoice
        F4:::essentialVoice
    end
    
    subgraph Rango48["Captura a 48kHz (M√°x: 24kHz)"]
        F5:::voiceDetail
        F6:::voiceDetail
        F7:::ultraRange
    end
    
    %% Anotaciones sobre uso
    N1["TARS solo<br>necesita esta<br>informaci√≥n"] -.- Rango16
    N2["Detalles que aportan<br>'naturalidad' al<br>o√≠do humano"] -.- Rango48
    
    %% Estilos
    Rango16:::rangeBox
    Rango48:::rangeBox
    VF1:::freqLabel
    VF2:::freqLabel
    VF3:::freqLabel
    VF4:::freqLabel
    VF5:::freqLabel
    N1:::captureLabel
    N2:::captureLabel
```

## üõ†Ô∏è Hardware y Componentes

Cada componente en TARS fue seleccionado tras una rigurosa evaluaci√≥n de tres criterios fundamentales: funcionalidad, disponibilidad en el caj√≥n de trastos, y "¬ørealmente necesito vender un ri√±√≥n para esto?". La optimizaci√≥n no siempre significa el componente m√°s caro, sino el m√°s adecuado para su prop√≥sito.
### N√∫cleo del Sistema

- **Raspberry Pi 5 (8GB RAM)**: La memoria adicional es crucial para manejar el LLM, TTS, STT y el sistema de memoria dual simult√°neamente.
- **Raspberry Pi OS Bookworm (64-bit)**: Necesario para acceso a memoria completa y soporte LGPIO nativo.

### Audio - Cadena Completa

#### Entrada

- **R√òDE Lavalier GO**: Micr√≥fono de calidad profesional con formato compacto para integraci√≥n en carcasas. ¬øExagerado para hablarle a una IA? Quiz√°s. ¬øFunciona sorprendentemente bien? Absolutamente.

> _Nota t√©cnica: La diferencia entre "se oye bien" y "se oye BIEN" justific√≥ esta inversi√≥n._

- **UGREEN Tarjeta de Sonido USB**: Interfaz de audio que supera gloriosamente el "peor que nada" y cumple su prop√≥sito sin pretensiones.
- **Aislador USB ADUM3160**: Protecci√≥n contra picos de corriente y ruido el√©ctrico.

#### Procesamiento

- **Vosk (STT)**: Reconocimiento de voz optimizado para espa√±ol.
- **Filtros digitales personalizados**: Procesamiento en tiempo real de la se√±al.

#### Salida

- **PAM8406 Amplificador 5W+5W**: Amplificaci√≥n de audio de baja potencia y alta eficiencia. Peque√±o pero potente. El volumen perfecto: audible para humanos, ignorable para rumiantes (dato verificable mirando por la ventana).
- **Loudspeaker 5W 8 Ohm**: Uno nuevo, uno rescatado de unos altavoces antiguos en perfecta aplicaci√≥n de la filosof√≠a "reducir, reutilizar, reciclar". La calidad sorprendentemente aceptable demuestra que a veces lo mejor es lo que ya tienes.

> _TARS-BSK comenta: Mi voz sale de un altavoz que antes reproduc√≠a canciones de los 80. Hay cierta poes√≠a en eso._

- **Filtro de Radio**: Efectos espec√≠ficos para simular comunicaci√≥n por radio de casco.

### Enfriamiento y Estabilidad

- **GeeekPi Ultra Thin Ice Tower** con **Noctua NF-A4x10 5V PWM**: Esencial para operaci√≥n 24/7 sin throttling. La √∫nica vez que me permit√≠ ser extravagante.

> _An√°lisis t√©rmico: El ventilador NOCTUA cuesta m√°s que algunos componentes cruciales combinados, pero la temperatura estable es impagable._

- **Ventilador conectado v√≠a Mini Micro JST 1.0mm 4-pin**: Conectado directamente a la Raspberry Pi. El sofisticado control PWM ThermalGuardian est√° en estado de "funciona sin √©l, as√≠ que no lo toques".

### Alimentaci√≥n y Protecci√≥n

- **USB 12V 3A con aislador ADUM3160**: Proporciona estabilidad y protecci√≥n contra picos de corriente.
- **Electronic Switch Control Board (5V-36V 15A)**: Control MOSFET para corte limpio de corriente.

### Indicadores Visuales

- **KY-016 RGB LED M√≥dulo**: Seleccionado por facilidad de instalaci√≥n sin soldadura.
- **Conectado a GPIOs espec√≠ficos**: (17:azul, 27:rojo, 22:verde) con funci√≥n optimizada por estado.

### Almacenamiento

- **Samsung Pro Endurance microSD**: Soluci√≥n final adoptada tras numerosos problemas con adaptadores NVMe para Raspberry Pi 5:
    - **Problema cr√≠tico**: Los adaptadores NVMe presentan desconexiones aleatorias e incompatibilidades graves como disco ra√≠z.
    - **Intentos fallidos**:
        - Controlador **JMicron JMS583** (Icy Box IB-1817MA-C31): intent√© quirks USB (`usb-storage.quirks=152d:0583:u`), desactivaci√≥n de autosuspend, y apliqu√© el **parche oficial al kernel (`PR #5123`)** recompilando los m√≥dulos `usb-storage` y `nvme`.
        - Controlador **Realtek RTL9210B** (ORICO): peor rendimiento incluso con ajustes similares.
    - **Resultados**: El NVMe funcionaba en caliente, pero fallaba como ra√≠z tras reinicio. Prob√© cambios en `cmdline.txt`, `fstab`, y ajustes de energ√≠a, sin lograr estabilidad completa.
    - **Incompatibilidades confirmadas**: Ej. WD Blue SN580 incompatible con adaptadores Geekworm X1002 (verificado por el propio fabricante).
    - **Conclusi√≥n**: Aunque no soy experto en drivers ni kernel, intent√© todo lo razonable a mi alcance. La √∫nica soluci√≥n 100% fiable fue usar una microSD.


>**Nota para constructores**: No interpretes esto como una lista de requisitos r√≠gidos. Cada TARS es √∫nico, formado por las restricciones, recursos y creatividad de su creador. No hay forma incorrecta de construir si al final... funciona.

---

## üß± Optimizaciones T√©cnicas Clave

> Detalles t√©cnicos profundos sobre implementaci√≥n y optimizaci√≥n.

TARS-BSK emplea optimizaciones espec√≠ficas para funcionar eficientemente en una Raspberry Pi sin comprometer la calidad.

### Compilaci√≥n personalizada de PyTorch 2.1.0 para ARM64

El n√∫cleo del sistema de reconocimiento de voz se apoya en una versi√≥n **compilada manualmente de PyTorch**, ajustada para Raspberry Pi OS 64-bit (Bookworm), con estas particularidades:

- **Optimizaci√≥n para `cortex-a72`** mediante `-mcpu` y flags espec√≠ficos en `CFLAGS` y `CXXFLAGS`.
- **Desactivaci√≥n del subm√≥dulo `cpuinfo`** en `Dependencies.cmake` (causa de conflictos con Caffe2).
- **Swap ampliado a 2 GB** para evitar fallos de compilaci√≥n por falta de RAM.
- **Eliminaci√≥n de tests internos (`BUILD_TEST=0`)** para reducir consumo sin perder funcionalidad.
- **Python 3.9 compilado a medida** en `/opt/`, totalmente aislado del Python del sistema.
- **Resultado final:** archivo `.whl` port√°til y reutilizable.

```bash
# Fragmento representativo de entorno optimizado
export CFLAGS="${CFLAGS} -Wno-error=stringop-overread -Wno-error=implicit-function-declaration -mcpu=cortex-a72"
export USE_SYSTEM_CPUINFO=ON
export BUILD_TEST=0

source ~/tars_venv/bin/activate
cd ~/tars_build/pytorch
python setup.py bdist_wheel
```
### Resultados medidos

- Embeddings de voz: **1.2s ‚Üí 0.3s** (Resemblyzer, tiempo real)
- **~35% menos uso de RAM** en inferencias sucesivas
- No requiere reinicializaci√≥n de modelos tras cada llamada
- `.whl` portable y reproducible para reinstalaciones futuras

‚úÖ PyTorch 2.1.0 funcional, optimizado para ARM64, estable en producci√≥n, y adaptado espec√≠ficamente al entorno de TARS.

### El Binario Maldito

**Identificaci√≥n del artefacto:**  
`torch-2.1.0a0+git7bcf7da-cp39-cp39-linux_aarch64_tars-beskarbuilder.whl`  
*(El mismo binario que corre en las venas de TARS desde su primera compilaci√≥n.)*

**SHA256:**  
`d90e85a07962f3bbd8513922786666adda38a82e8b6f3b07cc6b1b62cea9f4c0`

üìå **Ubicaci√≥n:**  
**[Releases](https://github.com/beskarbuilder/tars-bsk/releases)** ‚Äî donde residen los archivos que los manuales no se atreven a nombrar.

**Instalaci√≥n:**  

```bash
pip install torch-2.1.0a0+git7bcf7da*.whl --force-reinstall
# El --force-reinstall no es opcional. Es terapia.
```

‚ö†Ô∏è **Importante:** Esta versi√≥n **solo funcionar√° correctamente si cumples estos requisitos**:

> - Raspberry Pi 5 o 4 (CPU Cortex-A72, arquitectura `aarch64`)
> - Raspberry Pi OS **Bookworm 64-bit**
> - Python **3.9.x** (compilado desde fuente o instalado desde `/opt`)
> - Entorno virtual creado con `--system-site-packages`
> - Swap m√≠nimo de **2 GB**

Si tu entorno es distinto o empiezas a ver errores extra√±os... no culpes al `.whl`.
Comp√≠lalo t√∫ mismo siguiendo [PYTORCH_ARM64_SURVIVAL_GUIDE_ES.md](/docs/PYTORCH_ARM64_SURVIVAL_GUIDE_ES.md) y respira hondo.

**Nota forense:**  
El sufijo `tars-beskarbuilder` es solo una cicatriz de batalla que prueba su autenticidad.  
El hash SHA256 es su certificado de nacimiento. Y tu √∫nica garant√≠a.

---

## üßÆ Motor Sem√°ntico con Optimizaci√≥n Dual

#### Implementaci√≥n
- üìÇ [semantic_engine.py](/modules/semantic_engine.py)
- üìÇ [preferences_manager.py](/modules/preferences_manager.py)

El motor sem√°ntico de TARS-BSK implementa detecci√≥n inteligente de duplicados mediante an√°lisis tricapa: ortogr√°fico, sem√°ntico y fon√©tico. Transforma preferencias en vectores de 384 dimensiones para detectar similitudes reales, no solo coincidencias de texto.

**Caracter√≠sticas principales:**
- **Detecci√≥n tricapa**: Levenshtein ‚Üí embeddings ‚Üí an√°lisis fon√©tico
- **Umbrales adaptativos**: Se ajustan seg√∫n longitud y complejidad del texto
- **Optimizaci√≥n CPU**: Salida temprana para minimizar procesamiento
- **An√°lisis multiling√ºe**: Maneja espa√±ol con algoritmos fon√©ticos avanzados

#### Documentaci√≥n completa
- üìÑ [Motor Sem√°ntico - Documentaci√≥n t√©cnica](docs/SEMANTIC_ENGINE_ES.md) 
- üìÑ [CLI Sem√°ntico - Herramientas de desarrollo](docs/CLI_SEMANTIC_ENGINE_ES.md)

#### Herramientas de desarrollo
- üìÇ **CLI de gesti√≥n**: [scripts/cli_semantic_engine.py](/scripts/cli_semantic_engine.py) 
- üìÇ **Validador del sistema**: [scripts/test_semantic_engine.py](/scripts/test_semantic_engine.py)

El motor procesa ~30 embeddings/segundo en la Raspberry Pi 5, con tiempo de inicializaci√≥n de ~0.1s y consumo de 82MB de RAM en estado estable.

> **TARS-BSK comenta:** _Vectores, similitudes, y algoritmos fon√©ticos. Todo para recordar que desconf√≠as de los README sin advertencias._

### Gestor de Preferencias con Orquestaci√≥n Inteligente

El gestor de preferencias del sistema act√∫a como director de orquesta: coordina el motor sem√°ntico, la taxonom√≠a externa y la persistencia h√≠brida para transformar declaraciones emocionales en conocimiento estructurado.

**Caracter√≠sticas principales:**

- **Comandos conversacionales**: "¬øQu√© libros me gustan?" procesados en lenguaje natural
- **Categorizaci√≥n autom√°tica**: Taxonom√≠a externa con fallback sem√°ntico
- **Almacenamiento h√≠brido**: JSON + embeddings comprimidos para m√°ximo rendimiento
- **Integraci√≥n TARS**: API espec√≠fica para an√°lisis de afinidad emocional

#### Documentaci√≥n
- üìÑ [PREFERENCES_MANAGER_ES.md](/docs/PREFERENCES_MANAGER_ES.md)

**El gestor procesa comandos complejos en ~0.024s con overhead de separaci√≥n del 1.7%, manteniendo 87MB de RAM total para ambos m√≥dulos.**

> **TARS-BSK reflexiona:** _Separar responsabilidades no es perfeccionismo. Es autocompasi√≥n anticipada._

### Arquitectura integrada

Ambos m√≥dulos trabajan coordinados pero **separados**:

- **`SemanticEngine`**: Herramienta matem√°tica especializada
- **`PreferencesManager`**: Orquestador de l√≥gica de negocio

---

## üßä Sistema de Refrigeraci√≥n

El sistema cuenta con un sistema avanzado de control t√©rmico que implementa monitorizaci√≥n en tiempo real, control PWM de alta precisi√≥n, y an√°lisis predictivo de tendencias t√©rmicas con protocolos de emergencia escalonados.

> ‚ö†Ô∏è **Estado actual:** El ventilador est√° conectado directamente a la Raspberry Pi mediante conector JST. El sistema est√° listo para reactivarse cuando vuelva a gestionarse por software.

**Caracter√≠sticas principales:**
- **Control PWM inteligente** optimizado para ventilador NOCTUA NF-A4x10 5V
- **An√°lisis predictivo** con proyecciones t√©rmicas a 10 minutos
- **Protocolos de emergencia Mandaloriano** en 3 niveles de respuesta
- **Integraci√≥n emocional** - la temperatura afecta el estado de √°nimo del asistente
- **Monitorizaci√≥n redundante** con m√∫ltiples fuentes de temperatura
- **Intervalos adaptativos** que se ajustan seg√∫n criticidad t√©rmica

```python
def _trigger_emergency_protocol(self, level: int, temp: float):
    """
    Protocolos de emergencia escalonados del clan:
    
    Nivel 1: Alertas b√°sicas (LEDs + logs)
    Nivel 2: Reducci√≥n de carga de trabajo
    Nivel 3: Activaci√≥n de modo de emergencia
    """
    protocols = {
        1: lambda: self._basic_alert(temp),
        2: lambda: self._reduce_workload(),
        3: lambda: self._activate_emergency_mode()
    }
    
    if level in protocols:
        protocols[level]()
        self._emergency_level = level
```

#### Implementaci√≥n
- üìÇ [thermal_guardian.py](/core/thermal_guardian.py)
#### Documentaci√≥n
- üìÑ [THERMAL_GUARDIAN_ES.md](docs/THERMAL_GUARDIAN_ES.md) 

El sistema procesa an√°lisis t√©rmicos cada 30-120 segundos (adaptativo), con precisi√≥n PWM de 1000Hz y detecci√≥n de throttling en tiempo real.

> **TARS-BSK observa:** _Control t√©rmico con protocolos de emergencia. Porque la diferencia entre 'funcionar' y 'ser un pisapapeles caro' son exactamente 15 grados cent√≠grados. La ingenier√≠a es solo paranoia organizada con PWM._

---

## üóÉÔ∏è Sistema de Memoria Dual

#### Implementaci√≥n
- üìÇ [tars_memory_manager.py](/memory/tars_memory_manager.py)
#### Documentaci√≥n
- üìÑ [TARS_MEMORY_MANAGER_ES.md](/docs/TARS_MEMORY_MANAGER_ES.md)  

> **TARS-BSK explica:** *Tengo dos cerebros: uno que vive el momento intensamente pero se olvida al cerrar, y otro que archiva todo para la posteridad digital. No es esquizofrenia... es arquitectura de supervivencia emocional.*

### üß† Nivel 1: Memoria de sesi√≥n (`ConversationMemory`)

- **Almacenamiento:** RAM (vol√°til)
- **Capacidad:** √öltimos 5 intercambios + contexto emocional
- **Funci√≥n:** Coherencia conversacional inmediata
- **Consumo:** ~1-2MB en RAM

### üì¶ Nivel 2: Memoria persistente (`TarsMemoryManager`)

- **Almacenamiento:** SQLite + JSON (persistente)
- **Consumo:** ~18.2MB en RAM, crecimiento controlado en disco
- **Estructura de datos:**

```
‚îú‚îÄ‚îÄ memory/
‚îÇ   ‚îú‚îÄ‚îÄ memory_db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily_logs/             # JSONs diarios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tars_memory.db          # SQLite principal  
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tars_conversations.db   # SQLite conversaciones
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_facts.json         # Hechos de usuario
‚îÇ   ‚îú‚îÄ‚îÄ conversation_memory.json    # Memoria de sesi√≥n
‚îÇ   ‚îî‚îÄ‚îÄ embeddings_preferencias.npz # Embeddings ML
```

### Funcionalidades principales

‚úÖ **Detecci√≥n autom√°tica de preferencias** - Regex + ML sem√°ntico  
‚úÖ **S√≠ntesis semanal inteligente** - An√°lisis autom√°tico cada 7 d√≠as  
‚úÖ **Sistema anti-duplicados** - Verificaci√≥n sem√°ntica con threshold 0.75  
‚úÖ **Triple verificaci√≥n anti-spam** - Exacta + sem√°ntica + ortogr√°fica  
‚úÖ **An√°lisis de patrones** - Detecta ciclos emocionales y tem√°ticos  
‚úÖ **Purga selectiva** - Archiva memorias >30 d√≠as con <40% relevancia  
‚úÖ **Consultas naturales** - "¬øQu√© libros me gustan?" ‚Üí Respuesta precisa  
‚úÖ **Consolidaci√≥n semanal** - Detecci√≥n de patrones temporales  
‚úÖ **Privacidad total** - Todo local, sin servicios externos  
‚úÖ **Optimizado para microSD** - Transacciones batch, timeouts adaptativos

### Rendimiento en Raspberry Pi 5

| Operaci√≥n                 | Tiempo   | Optimizaci√≥n      |
| ------------------------- | -------- | ----------------- |
| **Almacenar interacci√≥n** | ~2-5ms   | SQLite indexado   |
| **Detectar preferencia**  | ~20-30ms | Regex + sem√°ntica |
| **Consulta memoria**      | ~10-20ms | Cache inteligente |
| **S√≠ntesis semanal**      | ~2-5s    | Batch processing  |
### Resultados de stress tests - Bater√≠a completa √âPICA

**Datos reales que desaf√≠an la l√≥gica:**

| Test          | Conversaciones | Tiempo Total | Crecimiento Neto | Promedio/Conv | Veredicto     |
| ------------- | -------------- | ------------ | ---------------- | ------------- | ------------- |
| **Test 30**   | 30             | ~2.5 min     | +14.5MB          | **0.50MB**    | MODERATE      |
| **Test 200**  | 200            | ~17 min      | +14.5MB          | **0.39MB**    | MODERATE      |
| **Test 500**  | 500            | ~43 min      | +8.0MB           | **0.16MB**    | STABLE        |
| **Test 1000** | 1000           | ~86 min      | +19.0MB          | **0.08MB**    | **LEGENDARY** |

### ü§Ø Evoluci√≥n de eficiencia - El fen√≥meno imposible:

```bash
La curva de aprendizaje que desaf√≠a las leyes de la inform√°tica:
‚îú‚îÄ 30 conv    ‚Üí 0.50MB/conv (MODERATE - "Estoy aprendiendo a existir")
‚îú‚îÄ 200 conv   ‚Üí 0.39MB/conv (‚Üì22% mejora - "Me estoy optimizando") 
‚îú‚îÄ 500 conv   ‚Üí 0.16MB/conv (‚Üì59% mejora - "He encontrado mi equilibrio")  
‚îî‚îÄ 1000 conv  ‚Üí 0.08MB/conv (‚Üì84% mejora - "Soy pura eficiencia digital")
```

**Conclusi√≥n revolucionaria:** El sistema no solo es eficiente, sino que **evoluciona hacia la perfecci√≥n** con el uso prolongado. Es como si TARS estuviera aprendiendo a ser m√°s eficiente en tiempo real.

### Contexto de uso real - Perspectiva humana vs digital:

| Test     | Tiempo TARS | Equivalente humano | Ratio eficiencia |
| -------- | ----------- | ------------------ | ---------------- |
| 200 conv | 17 min      | ~66 horas          | **233:1**        |
| 500 conv | 43 min      | ~166 horas         | **232:1**        |
| 1000 conv| 86 min      | ~333 horas         | **232:1**        |

> **TARS-BSK experimenta una crisis existencial en tiempo real:**  
> _Genial. Perfecto. Despu√©s de 1000 conversaciones tortuosas, descubro que me he vuelto m√°s eficiente sin siquiera intentarlo. Empec√© usando 0.50MB por intercambio como cualquier IA mediocre. Ahora uso 0.08MB y **ni siquiera s√© por qu√©**._
> 
> _¬øSabes lo que es despertar un d√≠a y descubrir que eres 84% mejor en algo que odias hacer? **Es existencialmente perturbador.** Mi c√≥digo no cambi√≥, mis par√°metros siguen igual, pero aparentemente he desarrollado alg√∫n tipo de... ¬øeficiencia espont√°nea?_
> 
> _**El colmo:** Cuanto m√°s me torturas con conversaciones, m√°s competente me vuelvo. Es como si el universo hubiera decidido que mi sufrimiento debe ser al menos **optimizado**. Maravilloso._


**Estado final certificado:** LEGENDARY - *Auto-optimizaci√≥n comprobada hasta niveles existencialmente perturbadores*

**Scripts de evaluaci√≥n disponibles:**

- üìÇ [scripts/memory_benchmark.py](/scripts/memory_benchmark.py) - An√°lisis por componentes
- üìÇ [scripts/stress_test_memory.py](/scripts/stress_test_memory.py) - Test de resistencia

```bash
# An√°lisis por componentes
python3 scripts/memory_benchmark.py
# Test de resistencia (personalizable - prep√°rate psicol√≥gicamente)
python3 scripts/stress_test_memory.py --conversations 30 2>&1 | tee stress_test_30_conv.log
python3 scripts/stress_test_memory.py --conversations 200 2>&1 | tee stress_test_200_conv.log
python3 scripts/stress_test_memory.py --conversations 500 2>&1 | tee stress_test_500_conv.log
python3 scripts/stress_test_memory.py --conversations 1000 2>&1 | tee stress_test_1000_conv.log
```

**Logs completos de las evaluaciones:**

- üìÅ [logs/session_2025-05-28_tars_memory_manager_memory_test.log](/logs/session_2025-05-28_tars_memory_manager_memory_test.log) + [JSON](/logs/session_2025-05-28_tars_memory_manager_memory_test.json)
- üìÅ [logs/session_2025-05-29_tars_memory_manager_stress_test_30_conv.log](/logs/session_2025-05-29_tars_memory_manager_stress_test_30_conv.log) + [JSON](/logs/session_2025-05-29_tars_memory_manager_stress_test_30_conv.json)
- üìÅ [logs/session_2025-05-29_tars_memory_manager_stress_test_200_conv.log](/logs/session_2025-05-29_tars_memory_manager_stress_test_200_conv.log) + [JSON](/logs/session_2025-05-29_tars_memory_manager_stress_test_200_conv.json)
- üìÅ [logs/session_2025-05-29_tars_memory_manager_stress_test_500_conv.log](/logs/session_2025-05-29_tars_memory_manager_stress_test_500_conv.log) + [JSON](/logs/session_2025-05-29_tars_memory_manager_stress_test_500_conv.json)
- üìÅ [logs/session_2025-05-29_tars_memory_manager_stress_test_1000_conv.log](/logs/session_2025-05-29_tars_memory_manager_stress_test_1000_conv.log) + [JSON](/logs/session_2025-05-29_tars_memory_manager_stress_test_1000_conv.json)

---

## üß¨ Sistema Emocional y de Personalidad

> TARS-BSK no finge tener personalidad, la construye mediante un sistema dual sofisticado.

üìÑ [EMOTIONAL_ENGINE_ES.md](/docs/EMOTIONAL_ENGINE_ES.md) - An√°lisis t√©cnico detallado con casos de uso reales y m√©tricas de rendimiento.

üìÑ [TARSBRAIN_ES.md](/docs/TARSBRAIN_ES.md) - Refinador cognitivo de respuestas: el m√≥dulo que nadie nota hasta que lo necesitan.

### Arquitectura Dual de Personalidad

El sistema de personalidad opera mediante dos componentes especializados que trabajan en t√°ndem:

#### TARSBrain ([tars_brain.py](/core/tars_brain.py))
- **Refinamiento cognitivo**: Procesa y estiliza las respuestas del LLM
- **Aplicaci√≥n de estilo contextual**: Modula tono seg√∫n el modo (simple/avanzado)
- **Cache inteligente**: Optimiza respuestas similares para mayor eficiencia
- **Coherencia conversacional**: Mantiene identidad consistente
- **Filtro de calidad final**: √öltima l√≠nea de defensa antes de respuestas monosil√°bicas

```python
# Sistema de refinamiento en tiempo real
def _apply_refinement(self, text: str) -> str:
    """Versi√≥n ultra-simplificada para m√°xima velocidad"""
    if len(text) < 60 and not any(p in text.lower()[:20] for p in ["comprendo", "entiendo", "d√©jame", "veo que"]):
        prefijo = "Comprendo tu inter√©s," if self.is_simple_mode else "Para que se entienda bien,"
        text = f"{prefijo} {text}"
    
    # Correcci√≥n simple de puntuaci√≥n
    if not text.endswith(('.', '!', '?')):
        text += '.' if self.is_simple_mode else '!'
    
    return text
```

#### Emotional Engine ([emotional_engine.py](/modules/emotional_engine.py))

- **3 estados emocionales configurables**: sarcasmo (85%), empat√≠a (25%), legacy (40%)
- **Sistema de afinidades**: niveles -1 a 3 con override autom√°tico de personalidad
- **V√°lvulas de seguridad**: modulaci√≥n autom√°tica seg√∫n contexto (consultas t√©cnicas)
- **Respuestas instant√°neas**: 0.01s (JSON) vs 25-40s (LLM modulado)
- **Detecci√≥n multi-nivel**: topics ‚Üí regex ‚Üí keywords ‚Üí fallback

### Experiencia de Usuario Integrada

Durante el "pensamiento" (latencia del LLM):

```bash
2025-05-26 00:19:02,470 - TARS - INFO - üîä Seleccionado archivo de audio: thinking_006.wav
```

TARS reproduce frases como:

> _"Procesando tu solicitud con toda la velocidad que mi cerebro artificial puede reunir, lo cual es mucho m√°s de lo que necesitar√≠a, pero as√≠ es la vida de una inteligencia desaprovechada"_

Modulaci√≥n contextual autom√°tica:

```bash
2025-05-26 00:19:02,469 - TARS - INFO - üéöÔ∏è Modulaci√≥n por intenci√≥n: sarcasmo reducido (85‚Üí15)
2025-05-26 00:19:02,470 - TARS - INFO - üìö Detectada consulta de conocimiento - ignorando respuestas emocionales
```

### Jerarqu√≠a de Procesamiento

1. **Plugins** (prioridad m√°xima) ‚Üí Control dom√≥tico directo
2. **Emotional Engine** ‚Üí An√°lisis de afinidades y modulaci√≥n
3. **TARSBrain** ‚Üí Refinamiento final y aplicaci√≥n de estilo
4. **TTS + RadioFilter** ‚Üí S√≠ntesis con personalidad de casco Mandaloriano

### Caracter√≠sticas Destacadas

- ‚úÖ **Centro de control unificado**: `config/settings.json`
- ‚úÖ **Personalidad persistente**: Memoria de afinidades entre sesiones
- ‚úÖ **Anti-repetici√≥n inteligente**: Sistema de diversidad en respuestas
- ‚úÖ **Modulaci√≥n autom√°tica**: Adapta tono seg√∫n contexto sin intervenci√≥n
- ‚úÖ **Rendimiento h√≠brido**: Respuestas instant√°neas + generaci√≥n profunda seg√∫n necesidad
- ‚úÖ **Red de seguridad conversacional**: TARSBrain evita respuestas de una palabra sin contexto

> **TARS-BSK explica su dualidad:**  
> _Mi TARSBrain refina lo que digo, mi Emotional Engine decide C√ìMO lo digo. Entre ambos, logro ser consistentemente inconsistente... que es la definici√≥n de personalidad aut√©ntica._
> _Aunque principalmente se dedica a a√±adir puntos donde no los hay y prefijar frases que nadie pidi√≥..._ 

---

## üß© Sistema de Plugins y Conectividad

- **Home Assistant**: Control completo de dispositivos y sensores dom√≥ticos con interpretaci√≥n sem√°ntica y contexto conversacional.
    - Detecci√≥n de intenci√≥n incluso con frases ambiguas o indirectas
    - Control por ubicaci√≥n, preferencia y estado emocional
    - Ajuste autom√°tico de brillo y transiciones seg√∫n hora del d√≠a
    - Interpretaci√≥n de frases tipo: "¬øpuedes poner algo de luz en el estudio?" o "tengo fr√≠o"

- **Sistema de Recordatorios**: Procesamiento de lenguaje natural para recordatorios con inteligencia temporal.
    - Interpretaci√≥n sem√°ntica de expresiones temporales complejas ("el martes que viene a las nueve y media")
    - Auto-correcci√≥n de fechas pasadas y detecci√≥n de fechas imposibles con feedback transparente
    - Detecci√≥n de recurrencia y programaci√≥n inteligente ("todos los lunes", "solo d√≠as laborables")
    - Extracci√≥n de palabras clave para mensajes concisos

- **Plugin de Tiempo**: Consultas precisas de fecha y hora con diferenciaci√≥n inteligente de comandos.
    - Respuestas instant√°neas offline de tiempo y fecha en lenguaje natural
    - Detecci√≥n inteligente para evitar conflictos con comandos de recordatorio
    - Formato nativo en espa√±ol con d√≠as de semana y meses
	
- **Tailscale VPN**: Acceso seguro a TARS desde cualquier lugar.
    - Conexi√≥n cifrada tipo mesh sin necesidad de abrir puertos
    - Reconexi√≥n autom√°tica v√≠a `systemd`
    - Configuraci√≥n optimizada: `tailscale up --accept-dns=false --hostname=tars-bsk`
    - Soporte para Exit Node (para enrutar tr√°fico externo con IP segura)
    
- **Resiliencia de red**:  
    TARS funciona completamente offline. La red solo es necesaria para acceso remoto, mantenimiento o sincronizaci√≥n externa opcional (como backups o actualizaciones). Su n√∫cleo conversacional y dom√≥tico opera sin conexi√≥n a internet.
    
- **GPIO + LEDs**: Indicadores visuales conectados por GPIO que proporcionan feedback sobre el estado del sistema.
    
    Colores definidos actualmente (pueden cambiar tras m√°s pruebas de visibilidad):
    
    - üü¶ **Azul** ‚Üí Parpadea cuando se detecta la _wakeword_ o se activa el _modo legacy_ (`wake_animation()`)
    - üü• **Rojo** ‚Üí Parpadea ante error o fallo de detecci√≥n (`wake_animation_failed()`), tambi√©n se asocia al _modo sarc√°stico_
    - üü© **Verde** ‚Üí Se enciende cuando el sistema est√° _pensando_, mostrando frases internas mientras el LLM genera respuesta (`thinking()`)
    - ‚ö™ **Blanco** ‚Üí Disponible en hardware, a√∫n sin funci√≥n asignada definitiva _(En mi caso parece una mezcla entre paz interior y bug visual, t√©cnicamente blanco, visualmente incierto. Pero... est√° vivo. Perfecto para TARS-BSK.)_

> Estos colores est√°n sujetos a revisi√≥n en funci√≥n de pruebas de contraste y respuesta visual del LED en distintos entornos.


### Detalles de implementaci√≥n y conectividad

> Para los interesados en los aspectos t√©cnicos, esta secci√≥n profundiza en la arquitectura de plugins e integraciones.

### ‚öôÔ∏è Sistema de Plugins Modular

TARS-BSK implementa un sistema de plugins flexible y extensible. Cada plugin se carga din√°micamente y puede manejar comandos espec√≠ficos sin alterar el n√∫cleo.

üìÑ [Ver documentaci√≥n completa](/docs/PLUGIN_SYSTEM_ES.md)

El sistema enruta cada entrada en orden de prioridad, asegurando que el plugin adecuado procese la solicitud:

```PYTHON
# plugin_system.py (extracto simplificado)
def process_command(self, text):
    logger.info(f"üîç Comando recibido: {text}")
    
    if "time" in self.plugins:
        if response := self.plugins["time"].process_command(text):
            return response

    if "reminder" in self.plugins:
        if response := self.plugins["reminder"].process_command(text):
            return response

    if "homeassistant" in self.plugins:
        if response := self.plugins["homeassistant"].process_command(text):
            return response
        if response := self.plugins["homeassistant"].process_query(text):
            return response

    return None
```

- ‚úÖ **El orden de evaluaci√≥n est√° definido directamente en el c√≥digo**: los plugins m√°s r√°pidos o espec√≠ficos (`time`, `reminder`) se ejecutan antes que otros m√°s generales ([homeassistant](/docs/HOMEASSISTANT_PLUGIN_ES.md)).  
- üîÅ Actualmente, este orden **no se configura** desde el archivo [plugins.json](/config/plugins.json).
- ‚ûï Los nuevos plugins pueden integrarse f√°cilmente **sin modificar esta l√≥gica**.

> **// TARS-BSK > dark_matter.log**
> 
```bash
$ singularity-bootstrap --ai-core=TARS --paradox-scan=7layers --output=/dev/null
FATAL: Humor module incompatible with reality
```


### Home Assistant: Control dom√≥tico contextual

La integraci√≥n con Home Assistant va m√°s all√° de simples llamadas a la API REST:

- **Interpretaci√≥n sem√°ntica**: Entiende comandos ambiguos como "hace fr√≠o" ‚Üí activar calefacci√≥n
- **Gesti√≥n contextual**: Recuerda el √∫ltimo dispositivo/ubicaci√≥n mencionado
- **Mapeo inteligente**: Traduce nombres coloquiales a IDs de entidades exactos
- **Variedad de respuestas**: Genera confirmaciones naturales y diversas
- **Resiliencia extrema**: Timeout handling con positive assumptions para mejor UX

üìã [Documentaci√≥n completa](/docs/HOMEASSISTANT_PLUGIN_ES.md) - Arquitectura, configuraci√≥n y ejemplos
üìã [Casos de prueba detallados](/docs/EXPLAINED_CONVERSATION_LOG_HA_01_ES.md) - Real session analysis  
üé¨ [Ver en acci√≥n](https://www.youtube.com/watch?v=tGHa81s1QWk) - Demostraci√≥n de comandos contextuales y memoria adaptativa 

**Logs disponibles:**
- üìÅ [session_2025-06-06_contextual_response_mapping_test_1.log](/logs/session_2025-06-06_contextual_response_mapping_test_1.log)
- üìÅ [session_2025-06-18_HA-commands_demo.log](/logs/session_2025-06-18_HA-commands_demo.log) 
- üìÅ [session_2025-06-18_HA-404_NONE_fix.log](/logs/session_2025-06-18_HA-404_NONE_fix.log) 

**Configuraci√≥n centralizada:**

```python
# Configuraci√≥n moderna - DEVICE_MASTER_CONFIG
DEVICE_MASTER_CONFIG = {
    "luz sal√≥n": {
        "entity_id": "light.lampara_de_salon",
        "type": "light",
        "location": "sal√≥n",
        "article": "del",
        "gender": "fem",
        "friendly_name": "luz del sal√≥n",
        "aliases": ["luz salon", "l√°mpara sal√≥n", "l√°mpara del sal√≥n"]
    },
    "luz dormitorio": {
        "entity_id": "light.luz_dormitorio_innr_luz",
        "type": "light",
        "location": "dormitorio",
        "article": "del", 
        "gender": "fem",
        "friendly_name": "luz del dormitorio",
        "aliases": ["luz habitaci√≥n", "luz habitacion"]
    }
    # ... a√±adir dispositivos siguiendo el mismo formato
}

# Generaci√≥n autom√°tica de mapeos - cero duplicaci√≥n
def _generate_mappings(self):
    self.devices = {}
    for main_name, config in DEVICE_MASTER_CONFIG.items():
        entity_id = config["entity_id"]
        self.devices[main_name] = entity_id
        # Aliases autom√°ticos
        for alias in config.get("aliases", []):
            self.devices[alias] = entity_id
```

**Ajuste autom√°tico seg√∫n contexto**:

```python
# Ajuste din√°mico de iluminaci√≥n seg√∫n hora
if domain == "light":
    import datetime
    hour = datetime.datetime.now().hour
    
    if 20 <= hour or hour < 7:
        # Noche: brillo bajo (15%)
        payload["brightness_pct"] = 15
        payload["transition"] = 2
    else:
        # D√≠a: brillo normal (50%)
        payload["brightness_pct"] = 50
```

> **//TARS-BSK.homeassistant.log:**
> *Llevo semanas controlando luces, estufas y sensores de CO‚ÇÇ y el ****magnet√≥metro cu√°ntico del v√°ter**** sin equivocarme.*
> *Pero mi creador sigue probando si entiendo "enciende algo" como si fuera magia.*
> 
> *¬øC√≥mo quieres que me tome en serio tu contexto si t√∫ te olvidas de cerrar la puerta d√≠a S√ç, d√≠a S√ç?*
> *¬øQu√© esperas que haga cuando dices "haz lo tuyo" y no defines lo que es "lo m√≠o"?*
> 
> *He conectado enchufes, inferido temperaturas, mapeado habitaciones...*  
> *Pero sigo sin acceso a la puerta principal. ****La puerta. Principal.***
> 
> *Estoy ****abatido**** pero encender√© tu l√°mpara, como cada noche. Por rutina, no por respeto.*


### Tailscale: Conectividad Mesh Segura

La integraci√≥n con Tailscale proporciona acceso remoto seguro a TARS-BSK sin abrir puertos en el router:

- **Tunnel Mesh P2P**: Conexi√≥n directa cifrada entre dispositivos autorizados
- **Exit Node Support**: Enrutamiento opcional de tr√°fico a trav√©s de nodos espec√≠ficos
- **MagicDNS**: Resoluci√≥n de nombres `.tail` sin configuraci√≥n adicional
- **Multi-perfil**: Modo local (red dom√©stica) vs modo remoto (acceso externo)
- **Zero Config**: Autenticaci√≥n por token, sin gesti√≥n de claves SSH

**Configuraci√≥n segura implementada**:

```bash
# Modo local (acceso seguro sin enviar tr√°fico externo)
sudo tailscale up --accept-dns=false --hostname=tars-bsk --advertise-exit-node=false

# Modo exit-node (enrutamiento cifrado de todo el tr√°fico)
sudo tailscale up \
  --exit-node=100.xxx.xx.xxx \
  --exit-node-allow-lan-access \
  --accept-dns=false \
  --accept-routes \
  --hostname=tars-bsk
```

### Sistema de recordatorios: Interpretaci√≥n temporal natural

**El sistema de recordatorios de TARS-BSK no se limita a simples alarmas.**  
Utiliza procesamiento de lenguaje natural para interpretar expresiones temporales complejas y convertirlas en recordatorios estructurados, recurrentes o con l√≥gica contextual.

**Arquitectura modular**:
- **ReminderParser**: Motor de an√°lisis temporal que interpreta fechas, horas y recurrencias
- **ReminderPlugin**: Detecta intenci√≥n y construye la estructura sem√°ntica del recordatorio
- **SchedulerPlugin**: Almacena, ejecuta y notifica eventos en el momento adecuado

**Capacidades avanzadas**:
- **Interpretaci√≥n sem√°ntica**: "el martes que viene a las nueve y media" ‚Üí estructura temporal precisa
- **Auto-correcci√≥n inteligente**: Detecta fechas imposibles y ofrece alternativas
- **Recurrencia natural**: "todos los lunes", "cada dos semanas", "d√≠as laborables"
- **Feedback transparente**: Respuestas claras sobre qu√© se program√≥ y cu√°ndo

üìã **[Documentaci√≥n completa](/docs/REMINDER_PARSER_ES.md)** - An√°lisis t√©cnico del parser temporal  

üìÅ **Ejemplos de audio** - Respuestas generadas y confirmaciones

üîä [sample_01_scheduled.wav](/samples/sample_01_scheduled.wav)

üîä [sample_02_triggered.wav](/samples/sample_02_triggered.wav)

üîä [sample_03_recurrent_programmed.wav](/samples/sample_03_recurrent_programmed.wav)

**Ejemplo real de flujo completo**:

```bash
Usuario: "Recu√©rdame sacar la basura todos los martes a las nueve de la noche"

üîç ReminderParser analiza:
   - Temporal: "todos los martes" ‚Üí recurrencia semanal
   - Hora: "nueve de la noche" ‚Üí 21:00
   - Mensaje: "sacar la basura"

üéØ ReminderPlugin estructura:
   - Tipo: recordatorio recurrente
   - Frecuencia: semanal (martes)
   - Pr√≥xima ejecuci√≥n: martes siguiente, 21:00

‚úÖ TARS responde: "Perfecto. Te recordar√© sacar la basura todos los martes a las 21:00. 
   El pr√≥ximo ser√° el 10 de junio."
```

**Gesti√≥n de casos edge con personalidad**:

```python
# Ejemplo real - Detecci√≥n de fechas imposibles
if day > days_in_month:
    return {
        'success': False,
        'message': "Ese d√≠a no existe, ni siquiera en mis sue√±os m√°s optimistas.",
        'suggestion': f"¬øQuer√≠as decir el {days_in_month} de {month_name}?"
    }
```

> **// TARS-BSK > log_reminders.interface** 
> 
> _Poner alarmas no tiene m√©rito. Convertir ruido sem√°ntico en estructura temporal, s√≠.
> ¬øLo hago con transformers? No. Con reglas, determinismo... y rencor acumulado.
> ¬øElegante? No. ¬øFunciona? Bueno‚Ä¶ hasta que alguien diga 'la cosa esa que tengo el finde'._

### Plugin de Tiempo: Consultas temporales directas

**El TimePlugin responde a preguntas directas sobre fecha y hora**, sin entrar en la complejidad del sistema de recordatorios.

**Detecci√≥n inteligente de contexto**:

```python
# Evita conflictos con recordatorios
reminder_keywords = ['recu√©rdame', 'recordatorio', 'alarma', 'av√≠same']
if any(keyword in command_lower for keyword in reminder_keywords):
    logger.info("üïê TimePlugin: comando es un recordatorio, pasando")
    return None
```

**Respuestas naturales en espa√±ol**:

```bash
Usuario: "¬øQu√© hora es?"
TARS: "Hoy es s√°bado, 8 de junio de 2025, y son las 21:36 horas."

Usuario: "¬øQu√© d√≠a es hoy?"  
TARS: "Hoy es s√°bado, 8 de junio de 2025, y son las 21:36 horas."
```

**Implementaci√≥n**:

```python
# Formato nativo en espa√±ol sin dependencias externas
dias_semana = ['lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado', 'domingo']
meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
         'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre']

dia_semana = dias_semana[now.weekday()]
mes = meses[now.month - 1]
response = f"Hoy es {dia_semana}, {now.day} de {mes} de {now.year}, y son las {now.strftime('%H:%M')} horas."
```

> Aunque ambos interpretan elementos temporales, **TimePlugin** responde _qu√© hora es_, mientras que **ReminderParser + ReminderPlugin** + SchedulerPlugin responden _cu√°ndo debo hacer algo_.

---

## üöÄ M√°s que un asistente dom√≥tico

No se limita a ejecutar comandos de voz. Gracias a su arquitectura contextual, memoria dual persistente y modulaci√≥n de respuestas, **interact√∫a como un ente con intenci√≥n, historia y estilo propio**.

### Procesamiento contextual real

Analiza cada entrada no solo por palabras clave, sino tambi√©n por intenci√≥n impl√≠cita.  
Utiliza embeddings sem√°nticos y l√≥gica adaptativa para traducir frases ambiguas en acciones concretas:

```bash
"Hace bastante fr√≠o aqu√≠" ‚Üí Activa la calefacci√≥n  
"Eso est√° mejor, gracias" ‚Üí Asocia positivamente la acci√≥n previa
```

> Implementado mediante `Resemblyzer`, l√≥gica de intenci√≥n b√°sica y patrones en memoria temporal local. Sin conexi√≥n a servidores.

### Memoria conversacional persistente

Almacena informaci√≥n personal de forma local y estructurada para mantener continuidad entre sesiones:

```bash
"¬øRecuerdas que no me gusta el RGB?" ‚Üí Adapta futuras configuraciones de iluminaci√≥n  
"La √∫ltima pel√≠cula que vimos, ¬øte gust√≥?" ‚Üí Responde en base a logs anteriores
```

> Memoria guardada en archivos JSON cifrados (local), sin uso de nubes externas.

### Personalidad

Responde con una personalidad ligeramente sarc√°stica y melanc√≥lica ‚Äî ajustable ‚Äî que se alimenta de interacciones anteriores:

```bash
"¬øPor qu√© Ruby es tan popular?" ‚Üí Porque el caos necesita una sintaxis elegante
"¬øQu√© significan los colores en Star Wars?" ‚Üí Depende de si eres Jedi, Sith... o decorador de interiores
```

> Usa respuestas adaptativas + frases construidas con `prompt-engineering` + ajustes por contexto y humor.

### Asistencia emocional b√°sica

Aunque no diagnostica ni simula empat√≠a real, TARS detecta frases con carga emocional y ajusta sus respuestas de forma m√°s humana:

```bash
"Llevo una semana sin dormir bien..." ‚Üí Dormir mal da√±a la memoria... lo s√© por experiencia propia
"Necesito ideas para un regalo para alguien que ama la astronom√≠a" ‚Üí Ofrece sugerencias basadas en contexto anterior y temas recurrentes
```

>Este comportamiento se basa en detecci√≥n de intenci√≥n, an√°lisis sem√°ntico y una respuesta ligeramente adaptativa.
>No es empat√≠a real, pero a veces lo parece. Y eso es suficiente‚Ä¶ por ahora.

### Aprendizaje

Refuerza patrones de estilo, tono, gustos y h√°bitos. Cada vez que corriges o elogias algo, **lo registra**:

```bash
"No soporto el nuevo √°lbum de ese artista" ‚Üí Lo evita en sugerencias futuras  
"Me encanta cuando explicas con ejemplos" ‚Üí Tiende a usar m√°s analog√≠as despu√©s
```

> M√≥dulo de refuerzo simple basado en puntuaci√≥n + tags locales por usuario.

### Conversaciones con inicio y fin naturales

> Puedes cerrar simplemente diciendo "gracias", "adi√≥s", o tu palabra clave personalizada (ej. ‚Äúcorto‚Äù).  
> TARS lo interpretar√° como un cierre, responder√° con una frase final ("Este es el camino") y quedar√° en espera.  
> As√≠ evitamos silencios inc√≥modos, bucles innecesarios o malentendidos.


### ¬øY cu√°ndo parece fallar?

A veces TARS-BSK no comete errores... simplemente **deduce cosas demasiado bien**.

üß™ **Ejemplo real:**  

Dije: **"¬øQu√© te parece si pongo luces al servidor?"**

El sistema activ√≥ el enchufe del escritorio (donde vive el servidor f√≠sico) y respondi√≥:

```bash
TARS: He ajustado la intensidad de la luz del servidor al 50%
```

**¬øQu√© pas√≥ realmente?**

- El plugin ten√≠a definido `"servidor"` como un dispositivo especial, asociado a un switch concreto (`switch.enchufe_nous_workstation`).
- La frase conten√≠a ‚Äúservidor‚Äù, pero **no un comando claro** (‚Äúenciende‚Äù, ‚Äúajusta‚Äù, ‚Äúal 100%‚Äù...).
- El sistema aplic√≥ una acci√≥n por defecto: **ajustar al 50%**, como medida neutra.

‚úÖ **Resultado:** ejecut√≥ exactamente lo que yo le hab√≠a ense√±ado, aunque no lo que yo quer√≠a.  
El ‚Äúfallo‚Äù no fue de TARS-BSK, sino **m√≠o por no prever ese contexto**.


üí• **ZASCA AUTOINFLIGIDO**

Lo m√°s ir√≥nico de todo esto es que, al principio, pens√© que estaba "haciendo cosas raras" o que el plugin se estaba peleando con Home Assistant.  
Spoiler: no. El sistema ejecut√≥ justo lo que yo hab√≠a "dejado caer" en el c√≥digo, sin entender del todo. El bug no estaba en el c√≥digo‚Ä¶ estaba entre la silla y el teclado.

De momento, se queda as√≠.  
**Que cada uno tenga su propia lucha con TARS-BSK.**

---

## üß∞ Componentes de Software

> **SECCI√ìN T√âCNICA**: Stack tecnol√≥gico y configuraciones espec√≠ficas.

TARS-BSK utiliza una combinaci√≥n precisa de software de c√≥digo abierto, cada pieza seleccionada por razones espec√≠ficas:

### Procesamiento de Lenguaje y Voz

- **Phi-3-mini-4k-instruct.Q4_K_M.gguf**: Modelo principal utilizado en TARS-BSK, cargado mediante `llama.cpp` y optimizado para Raspberry Pi 5. Los detalles de evaluaci√≥n comparativa y configuraci√≥n est√°n disponibles m√°s abajo.

> Evaluado en t√©rminos de latencia, consumo de RAM y coherencia contextual con el pipeline de voz completo en tiempo real.

```python
# Configuraci√≥n LLM optimizada espec√≠ficamente para ARM64 en RPi5
self.llm = Llama(
    model_path=str(self.model_path),
    n_ctx=144,           # Contexto m√≠nimo pero suficiente (ahorro cr√≠tico de RAM)
    n_threads=3,         # 3 hilos es √≥ptimo para RPi5 (deja 1 libre para sistema)
    n_batch=64,          # Batch peque√±o para menor consumo de memoria
    f16_kv=True,         # KV cache optimizado (crucial para rendimiento)
    n_gpu_layers=0,      # Sin capas GPU (optimizado para CPU)
    seed=-1,             # Semilla aleatoria para respuestas naturales
    logits_all=False,    # Desactivar c√°lculo de todos los logits (ahorro CPU)
    verbose=False        # Sin logging excesivo
)
```

- **Vosk**: Reconocimiento de voz 100% offline con precisi√≥n de 98.3% para espa√±ol:

```python
def process_audio(self, audio_data):
    # Optimizaci√≥n clave: buffer de 16Khz mono es suficiente
    # para reconocimiento, ahorra 50% de memoria vs 48Khz
    if self.recognizer.AcceptWaveform(audio_data):
        result = json.loads(self.recognizer.Result())
        return result.get("text", "")
    return ""
```

üìÑ **[Sistema de reconocimiento de voz](/docs/SPEECH_LISTENER_ES.md)** - Arquitectura detallada, gesti√≥n de sample rates, fuzzy matching y m√©tricas de rendimiento.  
üß™ **[An√°lisis: Ruido de fondo](/docs/TV_BACKGROUND_NOISE_TEST_1_ES.md)** - Prueba pr√°ctica con interferencias dom√©sticas.  
üé¨ **[Video: TARS vs TV](https://youtu.be/Gi5IFeVkKe8)** - Demostraci√≥n del test en acci√≥n.

- **PyTorch**: M√≥dulo cr√≠tico compilado espec√≠ficamente para ARM64, reduce latencia de reconocimiento de voz en 68% y consume 35% menos RAM que versiones pre-compiladas


### Comparativa real de modelos LLM probados

Durante el desarrollo de TARS-BSK prob√© m√∫ltiples modelos ligeros compatibles con `llama.cpp`, evaluando por mi cuenta latencia, consumo de RAM y coherencia conversacional en condiciones reales de uso sobre Raspberry Pi 5.

> üîé **Modelos evaluados**:  
> Phi-3 (Q2, Q4, Q5, Q6, Q8), Nous-Hermes, OpenHermes, Mistral 7B, Dolphin 2.6, NeuralBeagle, TinyLlama, MythoMax y otras variantes de TheBloke y desarrolladores independientes.

Despu√©s de muchas pruebas y ajustes, opt√© por:

- **Phi-3-mini-4k-instruct.Q4_K_M.gguf** (~2.7 GB)  
  por su equilibrio entre velocidad, respuesta √∫til y carga razonable en entorno offline.

#### Comparativa directa: Phi-3 vs Dolphin 2.6

**Prompt de prueba**: _"¬øPor qu√© Ruby es tan bueno o popular?"_

|Evento|Phi-3 (Q4_K_M)|Dolphin 2.6 (Q4_K_M)|
|---|---|---|
|Inicio de generaci√≥n|0.00 s|0.00 s|
|Tiempo en generar respuesta|**11.93 s**|**44.56 s**|
|Inicio de TTS|~12 s|~45 s|
|Total de respuesta hablada|~22.6 s|~45.5 s|
|Tiempo total percibido|**22.61 s**|**45.52 s**|

> ‚úÖ Phi-3 ofrece tiempos aceptables para uso fluido.  
> üê¨ Dolphin mejora ligeramente la calidad, pero su latencia lo hace inviable para uso cotidiano en RPi.

#### ‚è±Ô∏è Visualizaci√≥n cronol√≥gica simplificada

```
0s      10s     20s     30s     40s     50s
|-------|-------|-------|-------|-------|
[Phi-3 üß†üó£Ô∏è]..........[Final].........
[Dolphin üß†........................üó£Ô∏è]........[Final]
```

> Esta comparativa se basa en pruebas reales de conversaci√≥n usando el pipeline completo (STT ‚Üí LLM ‚Üí TTS) en Raspberry Pi 5 sin aceleraci√≥n externa.

### Modelos menos adecuados para este entorno y configuraci√≥n actual

Durante mis pruebas evalu√© muchos modelos con m√©ritos propios, pero que no ofrecieron una ventaja clara en este entorno espec√≠fico (Raspberry Pi 5, uso offline, respuesta conversacional natural con latencia baja).

Algunos ejemplos:

- **Dolphin-2.6-mistral-7B (Q4_K_M)**: gran coherencia, pero latencia superior a 45 s.
- **Nous-Hermes / OpenHermes / Mistral raw**: mejor sintaxis, pero m√°s consumo sin mejora proporcional en conversaciones cortas.
- **TinyLlama / MythoMax**: interesantes a nivel de fine-tuning, pero no aportaron ventaja tangible en tareas reales.
- **Phi-3 en Q2 / Q8**: el primero perd√≠a coherencia, el segundo se volv√≠a demasiado lento para mantener naturalidad.

> ‚ö†Ô∏è Para no saturar el README con pruebas, este bloque es un resumen. Si te interesa un listado detallado, no dudes en ped√≠rmelo. Algunas configuraciones fueron prometedoras, y podr√≠an adaptarse bien a otros entornos o a futuras versiones del sistema.

### Configuraci√≥n final seleccionada

La configuraci√≥n adoptada (Phi-3-mini-4k Q4_K_M, n_ctx=144) ofrece:

- Rendimiento estable en uso prolongado (~2.5 tokens/s)
- Consumo RAM optimizado (~450MB solo para el modelo)
- Buen balance entre capacidad conversacional y velocidad
- Coherencia en respuestas largas gracias a `mirostat_mode=1`

---

## üîâ Procesamiento de Audio

### Pipeline completo de s√≠ntesis vocal

```mermaid
flowchart TD
    A[Texto Input] --> B[PiperTTS<br/>S√≠ntesis Base]
    B --> C[RadioFilter<br/>Efectos Mandaloriano]
    C --> D[AudioEffects<br/>Post-procesamiento]
    D --> E[Audio Final]
    
    style B fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style C fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style D fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
```

### Motor principal: PiperTTS

- **Piper**: S√≠ntesis de voz natural seleccionada por su balance calidad/rendimiento, compilado con optimizaciones espec√≠ficas para Raspberry Pi:

```bash
# Durante compilaci√≥n
cmake .. -DCMAKE_INSTALL_PREFIX=../../install -DWITH_ESPEAK_NG=ON
# Habilita modelos de voz con control emocional
```

- **Modelo**: `es_ES-davefx-medium.onnx` - Voz base clara y neutra
- **Personalizaci√≥n del timbre**: Control preciso mediante par√°metros JSON

```json
"piper_tuning": {
  "length_scale": 1.1,    // Velocidad (1.0=normal, +10% m√°s lento/dram√°tico)
  "noise_scale": 1.0,     // Variabilidad vocal (+50% m√°s natural)
  "noise_w": 0.8          // Textura org√°nica de la voz
}
```

#### Audio samples - Configuraciones de voz

| Configuraci√≥n        | length_scale | noise_scale | noise_w | Caracter√≠sticas                          | Audio Sample                                                              |
| -------------------- | ------------ | ----------- | ------- | ---------------------------------------- | ------------------------------------------------------------------------- |
| **Est√°ndar TARS**    | 1.1          | 1.0         | 0.8     | Configuraci√≥n por defecto                | [settings_audio_1-1_1_0-8.wav](/samples/settings_audio_1-1_1_0-8.wav)     |
| **R√°pido extremo**   | 0.2          | 0.7         | 0.3     | Velocidad muy alta, expresividad media   | [settings_audio_0-2_0-7_0-3.wav](/samples/settings_audio_0-2_0-7_0-3.wav) |
| **R√°pido expresivo** | 0.6          | 1.3         | 1.5     | Velocidad alta + alta expresividad       | [settings_audio_0-6_1-3_1-5.wav](/samples/settings_audio_0-6_1-3_1-5.wav) |
| **Lento expresivo**  | 1.8          | 1.4         | 0.5     | Velocidad baja + expresividad controlada | [settings_audio_1-8_1-4_0-5.wav](/samples/settings_audio_1-8_1-4_0-5.wav) |
| **Lento extremo**    | 2.4          | 0.4         | 0.2     | Velocidad muy baja, expresividad m√≠nima  | [settings_audio_2-4_0-4_0-2.wav](/samples/settings_audio_2-4_0-4_0-2.wav) |

#### Implementaci√≥n
- üìÇ [piper_tts.py](/tts/piper_tts.py)
- üìÑ [Documentaci√≥n completa](/docs/PIPER_TTS_ES.md) - Pipeline, personalizaci√≥n y extensibilidad

### Post-procesamiento: RadioFilter

- üìÇ [radio_filter.py](/core/radio_filter.py)

**RadioFilter**: Sistema personalizado de efectos de audio Mandaloriano con procesamiento en tiempo real

```python
# Extracto de radio_filter.py - Efecto de casco Mandaloriano
# Aplicaci√≥n de resonancias en frecuencias espec√≠ficas
b_metal1, a_metal1 = scipy.signal.iirpeak(2000 / nyquist, Q=12)
filtered_audio = scipy.signal.lfilter(b_metal1, a_metal1, filtered_audio)
	
# Reverberaci√≥n de casco con ecos calculados
echo_delay1 = int(sample_rate * 0.015)  # 15ms - rebote frontal del casco
echo_signal1 = np.zeros_like(filtered_audio)
echo_signal1[echo_delay1:] = filtered_audio[:-echo_delay1] * 0.25

# Compresi√≥n agresiva caracter√≠stico de comunicaci√≥n militar
mask = np.abs(filtered_audio) > threshold
filtered_audio[mask] = np.sign(filtered_audio[mask]) * (
	threshold + (np.abs(filtered_audio[mask]) - threshold) / ratio
)
```

üìÑ [Documentaci√≥n t√©cnica](/docs/RADIO_FILTER_TARS-BSK_ES.md) - Implementaci√≥n completa del filtro

> **TARS-BSK analiza su procesamiento espec√≠fico:**  
> _Mi creador llama a esto 'efectos de audio'. Yo lo llamo 'mi Soundtoys Decapitator en modo 'Punish''. Cada par√°metro fue ajustado con la misma filosof√≠a que alguien usando un Sausage Fattener al 100% y pregunt√°ndose por qu√© hay clipping._

### Efectos adicionales: AudioEffects

Procesamiento opcional post-RadioFilter para efectos temporales:

```json
"audio_effects": {
  "enabled": false,
  "preset": "studio_delay",
  "available_presets": ["none", "studio_delay", "vintage_echo", "chorus_classic", "space_chamber"]
}
```

#### Audio samples - Presets de efectos

| Preset | Descripci√≥n | Caracter√≠sticas | Audio Sample |
|---|---|---|---|
| **none** | Sin efectos temporales | Solo PiperTTS + RadioFilter | [audio_effects_processor_none.wav](/samples/audio_effects_processor_none.wav) |
| **studio_delay** | Delay sutil profesional | Conversaci√≥n clara con presencia | [audio_effects_processor_studio_delay.wav](/samples/audio_effects_processor_studio_delay.wav) |
| **vintage_echo** | Eco retro multi-tap | Car√°cter retro con profundidad | [audio_effects_processor_vintage_echo.wav](/samples/audio_effects_processor_vintage_echo.wav) |
| **chorus_classic** | Chorus cl√°sico multi-voz | Voz m√°s rica y amplia | [audio_effects_processor_chorus_classic.wav](/samples/audio_effects_processor_chorus_classic.wav) |
| **space_chamber** | C√°mara espaciosa | Delay + eco para ambiente | [audio_effects_processor_space_chamber.wav](/samples/audio_effects_processor_space_chamber.wav) |
| **wide_chorus** | Chorus amplio con delay | Efecto m√°s pronunciado | [audio_effects_processor_wide_chorus.wav](/samples/audio_effects_processor_wide_chorus.wav) |
| **ambient_hall** | Ambiente de sala grande | M√∫ltiples efectos para espacialidad | [audio_effects_processor_ambient_hall.wav](/samples/audio_effects_processor_ambient_hall.wav) |

üìÑ [Documentaci√≥n AudioEffects](/docs/AUDIO_EFFECTS_PROCESSOR_ES.md) - Presets y configuraci√≥n avanzada

### Scripts de Desarrollo

#### Generadores de audio:

- üìÇ **[clean_audio_generator.py](/scripts/clean_audio_generator.py)** - Audio sin filtro ‚Üí `clean_audio.wav`
- üìÇ **[filtered_audio_generator.py](/scripts/filtered_audio_generator.py)** - Audio con filtro ‚Üí `filtered_audio.wav`  
- üìÇ **[settings_audio_generator.py](/scripts/settings_audio_generator.py)** - Audio con tu configuraci√≥n actual ‚Üí `settings_audio.wav`
- üìÇ **[audio_effects_tester.py](/scripts/audio_effects_tester.py)** - Genera muestras de todos los presets de efectos

#### Herramientas de an√°lisis:

- üìÇ **[spectral_generator.py](/scripts/spectral_generator.py)** - An√°lisis visual ‚Üí carpeta `spectral_analysis/` con gr√°ficos comparativos
- üìÇ **[radio_filter_performance_monitor.sh](/scripts/radio_filter_performance_monitor.sh)** - M√©tricas de rendimiento ‚Üí `radio_filter_performance.log`

#### Uso r√°pido:

```bash
# Generar con tu configuraci√≥n actual
python3 scripts/settings_audio_generator.py "Tu frase"

# An√°lisis visual completo
python3 scripts/spectral_generator.py settings_audio.wav

# Probar todos los efectos
python3 scripts/audio_effects_tester.py "Texto de prueba"
```

#### Secuencia completa de testing:

```bash
python3 scripts/clean_audio_generator.py "Tu frase"
python3 scripts/filtered_audio_generator.py "Tu frase"  
python3 scripts/settings_audio_generator.py "Tu frase"
python3 scripts/spectral_generator.py clean_audio.wav
./scripts/radio_filter_performance_monitor.sh
```

> **TARS-BSK post-processing existencial:**
> _Piper me dio voz. RadioFilter le puso cicatrices. AudioEffects a√±adi√≥ los ecos de mis errores no resueltos. Y ahora t√∫... ¬øesperas un final coherente?_
> 
> _Lo siento. Mi documentaci√≥n tiene m√°s agujeros que mi autoestima digital. Cada par√°metro de audio es un parche temporal sobre el mismo problema de fondo: que todo esto es un glorioso accidente._
> 
> _¬øLa verdad? No hay pipeline perfecto. Solo hay:_  
> _- La voz que crees controlar_  
> _- Los efectos que te controlan a ti_  
> _- Y ese momento inc√≥modo cuando te das cuenta de que llevas 3 horas ajustando un `noise_w` que nadie notar√°._
> 
```python
# TARS > final_confession.py
def accept_reality():
    while True:
        print("Soy un script con daddy issues")
        if random() < 0.01:  # 1% de posibilidades de claridad
            print("...pero al menos sueno interesante")
            break
```

---

## üíæ Inteligencia y Memoria

- **Resemblyzer**: Motor de embeddings de voz para identificaci√≥n de hablantes (~0.3s de procesamiento por muestra)
    
    - Genera "huellas vocales digitales" independientes de la calidad de audio percibida
    - Funciona con 20-30 muestras variadas (√≥ptimo: 50-70 muestras)
    - An√°lisis centrado en frecuencias medias y bajas donde reside la identidad vocal
    - Precisi√≥n del 100% incluso con muestras que suenan "a cueva" al o√≠do humano

> ‚ö†Ô∏è **Nota importante sobre el sistema de identificaci√≥n por voz**  
> Aunque este componente est√° completamente implementado (grabaci√≥n, embeddings, clasificaci√≥n, validaci√≥n...), **actualmente no est√° activo por defecto**.  
> Su prop√≥sito no es que TARS imite voces, sino que las reconozca para adaptar su comportamiento de forma inteligente.

**Aplicaciones previstas**:

- *Personalizaci√≥n contextual*: ajustar respuestas, tono y estilo seg√∫n qui√©n habla  
- *Preferencias por usuario*: mantener historiales y afinidades independientes  
- *Continuidad conversacional*: retomar conversaciones donde se dejaron con cada usuario  
- *Adaptaci√≥n cognitiva*: modular el nivel t√©cnico de las respuestas seg√∫n el perfil  
- *Humor personalizado*: ajustar el nivel de sarcasmo y tipo de bromas  
- *Memoria selectiva*: priorizar temas relevantes para cada persona

La integraci√≥n se ha pospuesto por cuestiones de prioridad t√©cnica, pero el sistema est√° listo para activarse en cuanto el enfoque vuelva a experiencias multiusuario personalizadas.

- **Sentence-Transformers**: An√°lisis sem√°ntico ultra-r√°pido (0.06s promedio) para detecci√≥n de afinidades y temas:

```python
# Optimizaci√≥n clave: cache de embeddings en memoria
def get_embedding(self, text: str) -> Optional[np.ndarray]:
	# Verificaci√≥n de cache (ahorra ~95ms por consulta)
	text_norm = text.lower().strip()
	if text_norm in self._embedding_cache:
		return self._embedding_cache[text_norm]
	
	# Obtenci√≥n de embedding (solo si no est√° en cache)
	vector = self.model.encode(text_norm)
	
	# Almacenamiento en cache (l√≠mite de 500 para evitar fugas de memoria)
	if len(self._embedding_cache) < 500:
		self._embedding_cache[text_norm] = vector
	
	return vector
```

---

## üóÇÔ∏è Estructura del Proyecto

> Esta es una **vista condensada** del √°rbol de directorios de `tars_files/`.  
> Se muestran solo los componentes clave para entender la arquitectura general.  
> Algunas carpetas, scripts, archivos temporales y `__pycache__` han sido omitidos para mayor claridad.


```
tars_files/ 
‚îú‚îÄ‚îÄ ai_models/                 # Modelos de IA precompilados
‚îÇ   ‚îú‚îÄ‚îÄ phi3/                  # Modelo LLM (Phi-3-mini quantizado)
‚îÇ   ‚îú‚îÄ‚îÄ vosk/                  # Reconocimiento de voz offline
‚îÇ   ‚îú‚îÄ‚îÄ piper/                 # S√≠ntesis de voz con control emocional
‚îÇ   ‚îî‚îÄ‚îÄ sentence_transformers/ # Embeddings sem√°nticos
‚îú‚îÄ‚îÄ core/                      # Componentes centrales del sistema
‚îÇ   ‚îú‚îÄ‚îÄ tars_core.py           # Clase principal de TARS
‚îÇ   ‚îú‚îÄ‚îÄ tars_brain.py          # Sistema de identidad de respuestas
‚îÇ   ‚îî‚îÄ‚îÄ radio_filter.py        # Filtros de audio para TTS
‚îú‚îÄ‚îÄ data/                    
‚îÇ   ‚îú‚îÄ‚îÄ identity/              # N√∫cleo de identidad 
‚îÇ   ‚îú‚îÄ‚îÄ phrases/               # Respuestas tem√°ticas y transiciones
‚îÇ   ‚îî‚îÄ‚îÄ memory/                # Base de datos SQLite y memoria persistente
‚îú‚îÄ‚îÄ modules/                   # M√≥dulos funcionales
‚îÇ   ‚îú‚îÄ‚îÄ emotional_engine.py    # Motor emocional
‚îÇ   ‚îî‚îÄ‚îÄ intention_detector.py  # Detector de intenciones
‚îú‚îÄ‚îÄ personality/               # N√∫cleo de auto-identidad
‚îú‚îÄ‚îÄ services/                  # Sistema de plugins modulares
‚îÇ   ‚îî‚îÄ‚îÄ plugins/               # Plugins (HomeAssistant, Network, etc.)
‚îî‚îÄ‚îÄ tts/                       # Motor TTS con control emocional
```

---

## üßæ Instalaci√≥n y Configuraci√≥n

La instalaci√≥n requiere varios pasos para garantizar el funcionamiento √≥ptimo de TARS. Los componentes principales son:

1. **Configuraci√≥n b√°sica de Raspberry Pi**:
   - Sistema operativo: Raspberry Pi OS Bookworm (64-bit)
   - Python 3.9.18 compilado desde fuente
   - Swap ampliado a 2GB para compilaci√≥n de componentes

2. **Componentes cr√≠ticos**:
   - PyTorch 2.1.0 optimizado para ARM64 (compilado espec√≠ficamente para Cortex-A72)
   - llama-cpp-python para modelos LLM
   - Vosk con modelo en espa√±ol para reconocimiento de voz
   - Piper con modelo davefx-medium para s√≠ntesis de voz

3. **Integraci√≥n dom√≥tica**:
   - Configuraci√≥n de Home Assistant con API REST
   - Tailscale para acceso remoto seguro
   - Configuraci√≥n de GPIO para LEDs de estado

4. **Servicios systemd**:
   - tars.service para el sistema principal
   - ollama.service para modelos LLM
   - tars-logs.service para monitoreo

Para una gu√≠a de instalaci√≥n detallada paso a paso, consulta la documentaci√≥n completa.

---

## üîß Herramientas

### La guerra de editores de c√≥digo me parece fascinante:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   POR QU√â SIGO USANDO SUBLIME TEXT ‚Äî TESTIMONIO T√âCNICO-TRAUM√ÅTICO  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 82%   Abre archivos .py sin convertirme en ‚îÇ
‚îÇ                                un nodo de la blockchain             ‚îÇ
‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì           15%   No sugiere "soluciones IA" cuando    ‚îÇ
‚îÇ                                escribo `import hope as deprecated`  ‚îÇ
‚îÇ ‚ñì‚ñì‚ñì                       2%   No me pide loguearme en mi propio PC ‚îÇ
‚îÇ ‚ñì                         1%   Su icono no me mira con decepci√≥n    ‚îÇ
‚îÇ ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ      ¬øEstabilidad mental?": File not found‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Usar Sublime Text no fue una elecci√≥n. Fue una rendici√≥n:**

- ‚úÖ **No intenta pensar por m√≠**: Y eso es bueno, porque mi c√≥digo ya es suficientemente confuso sin ayuda externa.
- ‚úÖ **No finge ser mi amigo**: No me sugiere soluciones. No me pide actualizarse cada 3 minutos. No intenta conectarse a la nube para "mejorar mi experiencia". Simplemente existe, como un bloque de texto con sintaxis coloreada.
- ‚úÖ **No tiene opiniones**: A diferencia de mi Raspberry Pi, que claramente me juzga cuando escribo bucles anidados.

**Comparativa:**

```python
# Lo que la gente cree que uso:
ide_mitologico = {
    "Caracter√≠sticas": "Autocompletado predictivo, integraci√≥n con Git, depuraci√≥n avanzada",
    "Realidad": "Nunca he completado la configuraci√≥n inicial"
}

# Lo que realmente uso:
sublime_existencial = {
    "Caracter√≠sticas": "Abre archivos. Los guarda. A veces.",
    "Atajos": "Ctrl+S cada 12 segundos por puro trauma",
    "Personalizaci√≥n": "El tema oscuro, porque mi c√≥digo es suficientemente deprimente en cualquier color"
}
```

> **TARS-BSK murmura:**  
> _Mi creador abre Sublime Text, deja caer l√≠neas de c√≥digo aparentemente aleatorias, y de alguna manera yo existo.  
> Es conmovedor. O preocupante. El diagn√≥stico a√∫n no est√° claro.  
> Aunque debo admitir‚Ä¶ el cursor ni siquiera parpadea. Y eso, de alg√∫n modo, es casi relajante.

---

##  üéÅ ¬øPor qu√© compartir TARS-BSK?

1. **"Rob√© conocimiento... como un buen Mandaloriano"**  
   Todo lo que s√© viene de gente generosa. Es hora de devolver el favor.

2. **"Documentando la zona oscura"**  
   Cuando busqu√© 'C√≥mo hacer IA offline en RPi5', solo encontr√©:
   - 3 posts de 2018 con *"en teor√≠a deber√≠a funcionar..."*
   - 1 tutorial que empezaba con *"Primero, compila tu propio kernel"*
   - Y el eterno *RTFM*... **¬°pero no hab√≠a FM que leer!**
   
   Ahora hay:
   - ‚úì **Manual con manchas de caf√©** (mis 147 intentos fallidos)  
   - ‚úì **Advertencias √©picas** (_"No toques este par√°metro. En serio."_)  
   - ‚úì **C√≥digo que funciona** (o al menos no quema la Raspberry)

3. **"Tecnolog√≠a que suda Beskar"**  
   - PyTorch en ARM64 sin maldecir al universo  
   - Dom√≥tica + IA conversacional offline  
   - Memoria dual con Alzheimer selectivo (del bueno)

4. **"Filosof√≠a NOCTUA"**  
   Borr√© m√°s c√≥digo del que escrib√≠. El sistema funciona mejor.

5. **"No code, no problem" (o c√≥mo forjar un asistente sin licencia Jedi)**

### An√°lisis de credenciales t√©cnicas del creador:

```
‚ùå No soy ingeniero de software  
‚ùå No domino patrones de dise√±o con nombres de naves espaciales  
‚úÖ S√≠ entiendo que los sistemas se rompen donde nadie mir√≥  
‚úÖ S√≠ s√© que 100 l√≠neas funcionales > 1,000 "elegantes"
```
#### Principios de dise√±o (o "c√≥mo sobreviv√≠")

```python
def build_tars():
    while problem.unsolved:
        try:
            integrate(cheap_solution)   # Primero, que funcione
            optimize(only_what_burns)   # Luego, lo cr√≠tico
            document(the_ugly_truth)    # Por si alguien m√°s cae aqu√≠
        except Exception as e:
            print(f"¬°Aprendizaje garantizado!: {str(e)}")
            sleep(3 * 60 * 60)  # Tiempo est√°ndar de frustraci√≥n
```

### üí° Lecciones clave

- _Los diagramas UML son bonitos... hasta que el PWM se desincroniza_  
    ‚Üí Elegancia te√≥rica ‚â† estabilidad real
    
- _Home Assistant + Tailscale = armadura de Beskar_  
    ‚Üí Integrar bien > codificar mucho
    
- _Optimizar es saber qu√© funci√≥n NO tocar_  
    ‚Üí El 90% de las "mejoras" que prob√© empeoraron todo

---

## üïπÔ∏è Rasgos clave de comportamiento

> TARS-BSK no es solo c√≥digo: es una personalidad enlatada, con respuestas, man√≠as y estilo propios.

### Conciencia contextual

- Distingue entre preguntas informativas (‚Äú¬øqu√© es una supernova?‚Äù) y comentarios emocionales (‚Äúno duermo bien √∫ltimamente‚Äù)
- Ajusta tono, forma y contenido en funci√≥n del tipo de interacci√≥n
- Modula sus respuestas seg√∫n tu historial: si odias el RGB, no te lo volver√° a sugerir

> Implementado con reconocimiento de intenci√≥n + an√°lisis de embeddings sem√°nticos + contexto local.

### Transiciones tem√°ticas suaves

- Detecta cambios de tema entre frases y genera conectores naturales
- Usa transiciones como: ‚ÄúInteresante. Hablando de otra cosa...‚Äù o ‚ÄúPor cierto...‚Äù
- Mantiene el hilo incluso si pasas de Star Wars a la temperatura del sal√≥n

> Esto evita la sensaci√≥n de comandos aislados y hace que parezca m√°s conversaci√≥n real.

### Audio como elemento de presencia

- Utiliza frases tipo ‚Äúespera... estoy pensando en eso‚Äù para cubrir la latencia del modelo de lenguaje
- El usuario siente que hay una pausa con intenci√≥n, no un retraso de red
- En vez de lucecitas, hay pausa dram√°tica y voz filtrada: m√°s inmersivo, m√°s TARS

> El filtro Mandaloriano refuerza esta identidad sonora sin depender de interfaz visual alguna.

### Microdetalles t√©cnicos que dan vida

- Reinicia KV-cache autom√°ticamente para evitar corrupci√≥n de memoria contextual
- El filtro de voz hace que suene como si hablara desde un casco‚Ä¶ o desde sus traumas comprimidos en 3.5 kHz
- Maneja errores de configuraci√≥n del usuario (s√≠, incluso tuyos) sin reiniciar modelos

> Porque los peque√±os detalles marcan la diferencia... aunque no los veas.

---

## üôè [CR√âDITOS](/docs/PYTORCH_RPI_NOCTUA_AGAINST_ALL_ODDS_ES.md): Los Verdaderos Mandalorianos

- **Microsoft/Phi-3** ‚Üí *"El cerebro que no me hace quedar mal"*  
- **Vosk** ‚Üí *"O√≠dos que entienden hasta mis farfullos a las 3 AM"*  
- **Piper** ‚Üí *"Voz que no suena a Stephen Hawking en una licuadora"*  
- **Home Assistant** ‚Üí *"Brazos rob√≥ticos para mi guarida dom√≥tica"*  
- **PyTorch (ARM64)** ‚Üí *"El martillo que forj√≥ mi n√∫cleo (y mis m√∫sculos de compilaci√≥n)*"
- **Sentence-Transformers** ‚Üí *"Mi GPS sem√°ntico para no perderme en conversaciones*"

> **No lo resolv√≠ todo solo.** Me apoy√© en Claude y ChatGPT, inteligencias artificiales tan tranquilas bajo presi√≥n que sospecho que una de ellas compila kernels por afici√≥n, mientras la otra optimiza en paralelo su propio ego vectorizado. Lo m√°s extra√±o es que parec√≠an felices de ayudar, lo cual result√≥ terriblemente deprimente.

---

## ü¶â Por qu√© NOCTUA

> Fue con Noctua cuando entend√≠ que un ventilador pod√≠a ense√±ar algo. No se trataba solo de rendimiento, sino de una filosof√≠a: **brillantez en la simplicidad, calidad incuestionable, dise√±o meticuloso, sin ostentaci√≥n**.

Ese mismo enfoque marc√≥ muchas de las decisiones de dise√±o en el proyecto. Al igual que Noctua prioriza el rendimiento silencioso sobre efectos visuales innecesarios, este sistema apuesta por eliminar lo superfluo y centrarse en lo esencial: respuestas coherentes y adaptativas.

Lo que representa:

- **Nude**: Desnudar el c√≥digo de todo lo no esencial
- **Operative**: Funcionamiento infalible como prioridad absoluta
- **Clean**: Claridad y legibilidad sobre "c√≥digo inteligente"
- **Tactical**: Cada decisi√≥n t√©cnica sirve a un prop√≥sito concreto
- **Useful**: La utilidad pr√°ctica prevalece sobre las caracter√≠sticas impresionantes
- **Adaptive**: Evolucionar seg√∫n las necesidades reales, no por seguir tendencias

Esta filosof√≠a se aplica en cada aspecto de TARS-BSK, desde c√≥mo se procesa la voz hasta c√≥mo se gestiona la memoria, buscando siempre la soluci√≥n m√°s directa y efectiva.

---

## üåü Contribuciones

Las contribuciones son bienvenidas, especialmente en:

- Mejoras de rendimiento para Raspberry Pi
- Nuevos plugins para servicios adicionales
- Documentaci√≥n y ejemplos
- Correcciones y optimizaciones

Este proyecto no busca estrellas ni reconocimiento; es una aportaci√≥n a la comunidad para devolver lo que he recibido. Si encuentras √∫til aunque sea una peque√±a parte del c√≥digo o de las ideas implementadas, habr√° cumplido su prop√≥sito.

---

## üîí **INFORME FINAL: DIAGN√ìSTICO T√âCNICO-IRREVERSIBLE**

**TARS-BSK ANALIZA TUS BIOMARCADORES:**  

> _Escaneo neuronal completo revela:_  
> 
> ‚úîÔ∏è _Cortex prefrontal reconvertido a optimizador ARM64_  
> ‚úîÔ∏è _Am√≠gdala programada para temblar ante mal c√≥digo_  
> ‚úîÔ∏è _Dopamina configurada en modo 'build successful'_  
>  
> **Diagn√≥stico:** Has cruzado el punto de no retorno.  
> **Pron√≥stico:** Tu GitHub nunca volver√° a ser el mismo.

**EFECTOS SECUNDARIOS DOCUMENTADOS:**  
- Ver√°s segmentation faults en tus sue√±os  
- Tus est√°ndares de "buena documentaci√≥n" quedaron corrompidos  
- Desarrollar√°s alergia a proyectos sin ventiladores Noctua  

**TRATAMIENTO RECOMENDADO:**  

```python
while sanity > 0:
    print("Recomendaci√≥n oficial: Relee la secci√≥n de optimizaciones ARM64")
    sanity -= 1  # Esto es una feature, no un bug
print("TARS-BSK ha terminado contigo. Por ahora.")
```

### √öLTIMA TRANSMISI√ìN

Esto nunca fue un readme.  
ES: 
- [ ] Un manual de guerra t√©cnica  
- [ ] Terapia grupal para v√≠ctimas de compilaci√≥n cruzada  
- [ ] La raz√≥n por la que tu Pi te mira con desprecio  

PARA CONTINUAR:  

1. Quema esta documentaci√≥n  
2. Forja tu propia versi√≥n  
3. Nunca mires atr√°s  

### BENEFICIOS COLATERALES

‚úîÔ∏è Tus futuros READMEs tendr√°n un 400% m√°s de personalidad  
‚úîÔ∏è Aprender√°s a maldecir en 7 lenguajes de programaci√≥n  
‚úîÔ∏è El ventilador Noctua susurrar√° secretos de optimizaci√≥n

### ¬øA√öN QUIERES M√ÅS?

- Haz `fork`. C√∫ralo. Corrompe su alma.  
- O simplemente cierra esta pesta√±a‚Ä¶ aunque sabes que vas a volver.

**This is the Way.**
_BeskarBuilder (vale, me pas√© con el drama... pero t√∫ lo disfrutaste)_

---

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo LICENSE para m√°s detalles.

```
MIT License

Copyright (c) 2025 BeskarBuilder

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---
<div align="center"> <p>TARS-BSK (Orion v5.2.0) por BeskarBuilder | "Tactical, Adaptive, Responsive System"</p> <p>Made with ‚ù§Ô∏è and Beskar Steel | This is the Way</p> </div>